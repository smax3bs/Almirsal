<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿßŸÑŸÖÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÖÿ™ÿ∑Ÿàÿ± - ŸÜÿ∏ÿßŸÖ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿ™ŸÅÿßÿπŸÑŸä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* ÿ´ŸäŸÖÿßÿ™ ŸÖŸÑŸàŸÜÿ© */
        :root {
            --primary-color: #667eea;
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .theme-blue {
            --primary-color: #3b82f6;
            --primary-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        
        .theme-green {
            --primary-color: #10b981;
            --primary-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .theme-purple {
            --primary-color: #8b5cf6;
            --primary-gradient: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        .theme-pink {
            --primary-color: #ec4899;
            --primary-gradient: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
        }
        
        .theme-orange {
            --primary-color: #f59e0b;
            --primary-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .gradient-bg {
            background: var(--primary-gradient);
            min-height: 100vh;
        }
        
        .chat-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            height: 90vh;
            display: flex;
            flex-direction: row;
            overflow: hidden;
        }
        
        .sidebar {
            background: rgba(255, 255, 255, 0.9);
            border-left: 1px solid #e2e8f0;
            width: 300px;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }
        
        .chat-header {
            padding: 16px;
            background: white;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }
        
        .message-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8fafc;
            min-height: 0;
        }
        
        .input-area {
            padding: 16px;
            background: white;
            border-top: 1px solid #e2e8f0;
            display: flex;
            align-items: flex-end;
            gap: 8px;
            flex-shrink: 0;
        }
        
        .message-input {
            flex: 1;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 12px 16px;
            resize: none;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.4;
            max-height: 120px;
            min-height: 44px;
            transition: all 0.3s ease;
        }
        
        .message-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .file-btn, .send-btn {
            width: 34px;
            height: 34px;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .file-btn {
            background: #f1f5f9;
            color: #64748b;
        }
        
        .file-btn:hover {
            background: #e2e8f0;
            transform: scale(1.1);
        }
        
        .send-btn {
            background: var(--primary-gradient);
            color: white;
        }
        
        .send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-end;
            gap: 10px;
            animation: slideIn 0.3s ease;
            position: relative;
        }
        
        .message.sent {
            flex-direction: row-reverse;
        }
        
        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
        }

        /* ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÜÿ¨ŸàŸÖ */
        .star-rating {
            display: flex;
            align-items: center;
            gap: 2px;
            margin-top: 8px;
            padding: 4px 8px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 12px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .message.sent .star-rating {
            background: rgba(255, 255, 255, 0.2);
        }

        .star-rating:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }

        .message.sent .star-rating:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .star {
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .star:hover {
            transform: scale(1.3);
            filter: drop-shadow(0 0 5px gold);
        }

        .star.filled {
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .star.empty {
            color: #ddd;
        }

        .message.sent .star.empty {
            color: rgba(255, 255, 255, 0.5);
        }

        .rating-popup {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 20px;
            padding: 10px 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            gap: 5px;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            border: 2px solid #ffd700;
        }

        .rating-popup.show {
            opacity: 1;
            pointer-events: all;
            transform: translateX(-50%) translateY(-10px);
        }

        .rating-popup .star {
            font-size: 24px;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .rating-popup .star:hover {
            background: #fff3cd;
            transform: scale(1.2) rotate(15deg);
        }

        .rating-count {
            font-size: 11px;
            color: #666;
            margin-right: 5px;
            font-weight: 500;
        }

        .message.sent .rating-count {
            color: rgba(255, 255, 255, 0.8);
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑŸÜÿ¨ŸàŸÖ ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ© */
        .star-burst {
            position: absolute;
            pointer-events: none;
            font-size: 20px;
            z-index: 1001;
            animation: starBurst 1s ease-out forwards;
        }

        @keyframes starBurst {
            0% {
                opacity: 1;
                transform: scale(0.5) rotate(0deg);
            }
            50% {
                opacity: 1;
                transform: scale(1.5) rotate(180deg);
            }
            100% {
                opacity: 0;
                transform: scale(2) rotate(360deg) translateY(-50px);
            }
        }

        .rating-celebration {
            animation: ratingCelebration 0.8s ease-in-out;
        }

        @keyframes ratingCelebration {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1) rotate(5deg); }
            50% { transform: scale(1.2) rotate(-5deg); }
            75% { transform: scale(1.1) rotate(3deg); }
        }
        
        .message.received .message-bubble {
            background: white;
            border-bottom-right-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .message.sent .message-bubble {
            background: var(--primary-gradient);
            color: white;
            border-bottom-left-radius: 4px;
        }

        .contact-item {
            padding: 15px;
            border-bottom: 1px solid #f1f5f9;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }
        
        .contact-item:hover {
            background: #f8fafc;
            transform: translateX(-5px);
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
        }
        
        .contact-item.active {
            background: var(--primary-gradient);
            color: white;
            transform: translateX(-10px);
            box-shadow: 10px 0 20px rgba(102, 126, 234, 0.3);
        }
        
        .avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 22px;
            position: relative;
            transition: all 0.3s ease;
        }
        
        .avatar:hover {
            transform: scale(1.1) rotate(5deg);
        }
        
        .online-indicator {
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            border: 2px solid white;
            position: absolute;
            bottom: 2px;
            left: 2px;
            animation: pulse 2s infinite;
        }

        .search-bar {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .search-input {
            width: 100%;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            padding: 10px 15px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px 8px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #64748b;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        
        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
        }
        
        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        .hidden {
            display: none !important;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© */
        .interactive-message {
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: visible;
        }

        .interactive-message:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .message-bubble.interactive {
            position: relative;
            overflow: visible;
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ∂ÿ≠ŸÉ */
        .laugh-effect {
            animation: laughShake 0.6s ease-in-out;
        }

        @keyframes laughShake {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-2deg) scale(1.05); }
            50% { transform: rotate(2deg) scale(1.1); }
            75% { transform: rotate(-1deg) scale(1.05); }
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ÿ® */
        .love-effect {
            animation: loveFloat 1s ease-in-out;
        }

        @keyframes loveFloat {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) translateY(-5px); }
            100% { transform: scale(1); }
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ∫ÿ∂ÿ® */
        .angry-effect {
            animation: angryShake 0.5s ease-in-out;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52) !important;
        }

        @keyframes angryShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≠ÿ≤ŸÜ */
        .sad-effect {
            animation: sadDrop 1s ease-in-out;
            filter: blur(1px);
        }

        @keyframes sadDrop {
            0% { transform: translateY(0); opacity: 1; }
            50% { transform: translateY(5px); opacity: 0.7; }
            100% { transform: translateY(0); opacity: 1; }
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ•ÿπÿ¨ÿßÿ® */
        .wow-effect {
            animation: wowPulse 0.8s ease-in-out;
        }

        @keyframes wowPulse {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.1); }
            50% { transform: scale(1.2); }
            75% { transform: scale(1.1); }
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ */
        .party-effect {
            animation: partyBounce 1s ease-in-out;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7) !important;
            background-size: 300% 300% !important;
            animation: partyBounce 1s ease-in-out, partyColors 2s ease-in-out infinite !important;
        }

        @keyframes partyBounce {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-10px) rotate(2deg); }
            50% { transform: translateY(-15px) rotate(-2deg); }
            75% { transform: translateY(-5px) rotate(1deg); }
        }

        @keyframes partyColors {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑŸÜŸàŸÖ */
        .sleep-effect {
            animation: sleepSway 2s ease-in-out infinite;
            opacity: 0.7;
        }

        @keyframes sleepSway {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(1deg); }
            75% { transform: rotate(-1deg); }
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ∑ÿπÿßŸÖ */
        .food-effect {
            animation: foodYum 0.8s ease-in-out;
        }

        @keyframes foodYum {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15) rotate(5deg); }
        }

        /* ŸÅŸÇÿßÿπÿßÿ™ ÿßŸÑÿ™ŸÅÿßÿπŸÑ */
        .reaction-bubble {
            position: absolute;
            pointer-events: none;
            font-size: 20px;
            z-index: 1000;
            animation: bubbleFloat 2s ease-out forwards;
        }

        @keyframes bubbleFloat {
            0% {
                opacity: 0;
                transform: translateY(0) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translateY(-10px) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px) scale(1.2);
            }
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿÆÿßÿµÿ© */
        .word-highlight {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
            animation: wordGlow 1s ease-in-out;
        }

        @keyframes wordGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.5); }
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿßŸáÿ™ÿ≤ÿßÿ≤ */
        .vibrate-effect {
            animation: vibrate 0.3s ease-in-out;
        }

        @keyframes vibrate {
            0%, 100% { transform: translateX(0); }
            10% { transform: translateX(-2px); }
            20% { transform: translateX(2px); }
            30% { transform: translateX(-2px); }
            40% { transform: translateX(2px); }
            50% { transform: translateX(-2px); }
            60% { transform: translateX(2px); }
            70% { transform: translateX(-2px); }
            80% { transform: translateX(2px); }
            90% { transform: translateX(-2px); }
        }

        /* === ŸÜÿ∏ÿßŸÖ ÿßŸÑŸáÿØÿßŸäÿß === */
        .gift-menu {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: white;
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            display: none;
            border: 2px solid var(--primary-color);
            min-width: 200px;
        }

        .gift-menu.show {
            display: block;
            animation: giftMenuSlide 0.3s ease-out;
        }

        @keyframes giftMenuSlide {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .gift-menu h3 {
            text-align: center;
            margin: 0 0 15px 0;
            color: var(--primary-color);
            font-size: 16px;
            font-weight: bold;
        }

        .gift-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .gift-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px 10px;
            border: 2px solid #f1f5f9;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .gift-option:hover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .gift-option .gift-emoji {
            font-size: 30px;
            margin-bottom: 5px;
            transition: all 0.3s ease;
        }

        .gift-option:hover .gift-emoji {
            transform: scale(1.2) rotate(10deg);
        }

        .gift-option .gift-name {
            font-size: 12px;
            color: #666;
            text-align: center;
            font-weight: 500;
        }

        .gift-option:hover .gift-name {
            color: var(--primary-color);
        }

        /* ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸáÿØÿßŸäÿß */
        .gift-message {
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4, #45b7d1);
            background-size: 200% 200%;
            animation: giftGradient 3s ease infinite;
            color: white;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            max-width: 250px;
            margin: 10px auto;
        }

        @keyframes giftGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .gift-message::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: giftShine 2s ease-in-out infinite;
        }

        @keyframes giftShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .gift-content {
            position: relative;
            z-index: 2;
        }

        .gift-emoji-large {
            font-size: 50px;
            display: block;
            margin-bottom: 10px;
            animation: giftBounce 1s ease-in-out infinite alternate;
        }

        @keyframes giftBounce {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.1) rotate(5deg); }
        }

        .gift-text {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .gift-sender {
            font-size: 12px;
            opacity: 0.9;
            font-style: italic;
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸÅÿ™ÿ≠ ÿßŸÑŸáÿØŸäÿ© */
        .gift-opening {
            animation: giftOpen 2s ease-in-out;
        }

        @keyframes giftOpen {
            0% {
                transform: scale(0.5) rotate(0deg);
                opacity: 0;
            }
            25% {
                transform: scale(0.8) rotate(10deg);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.2) rotate(-5deg);
                opacity: 1;
            }
            75% {
                transform: scale(0.9) rotate(3deg);
                opacity: 1;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        /* ÿ¨ÿ≤Ÿäÿ¶ÿßÿ™ ÿßŸÑŸáÿØŸäÿ© */
        .gift-particle {
            position: absolute;
            pointer-events: none;
            z-index: 1001;
            font-size: 20px;
            animation: giftParticleFloat 3s ease-out forwards;
        }

        @keyframes giftParticleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(0.5) rotate(0deg);
            }
            50% {
                opacity: 1;
                transform: translateY(-30px) scale(1) rotate(180deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-60px) scale(1.5) rotate(360deg);
            }
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑŸáÿØÿßŸäÿß ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ© */
        .gift-rose {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
        }

        .gift-chocolate {
            background: linear-gradient(135deg, #8b4513, #d2691e);
        }

        .gift-star {
            background: linear-gradient(135deg, #ffd700, #ffb347);
        }

        .gift-heart {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }

        .gift-diamond {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .gift-crown {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÜÿ®ÿ∂ÿßÿ™ ŸÑŸÑŸáÿØÿßŸäÿß */
        .gift-pulse {
            animation: giftPulse 1.5s ease-in-out infinite;
        }

        @keyframes giftPulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7);
            }
            50% {
                box-shadow: 0 0 0 20px rgba(255, 107, 107, 0);
            }
        }

        /* ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑŸáÿØÿßŸäÿß */
        .gift-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            text-align: center;
            border: 3px solid var(--primary-color);
            animation: giftNotificationShow 0.5s ease-out;
        }

        @keyframes giftNotificationShow {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .gift-notification .gift-emoji-huge {
            font-size: 80px;
            margin-bottom: 15px;
            animation: giftNotificationBounce 1s ease-in-out infinite;
        }

        @keyframes giftNotificationBounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(10deg); }
        }

        .gift-notification h2 {
            color: var(--primary-color);
            margin: 0 0 10px 0;
            font-size: 24px;
        }

        .gift-notification p {
            color: #666;
            margin: 0 0 20px 0;
            font-size: 16px;
        }

        .gift-notification button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .gift-notification button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* === ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ© === */
        .memory-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s ease;
        }

        .memory-popup.show {
            opacity: 1;
            pointer-events: all;
        }

        .memory-card {
            background: white;
            border-radius: 25px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
            transform: scale(0.8) translateY(50px);
            transition: all 0.5s ease;
            border: 3px solid var(--primary-color);
            position: relative;
            overflow: hidden;
        }

        .memory-popup.show .memory-card {
            transform: scale(1) translateY(0);
        }

        .memory-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: memoryShine 3s ease-in-out infinite;
        }

        @keyframes memoryShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .memory-header {
            margin-bottom: 30px;
            position: relative;
            z-index: 2;
        }

        .memory-header h2 {
            color: var(--primary-color);
            font-size: 28px;
            margin: 0 0 10px 0;
            font-weight: bold;
        }

        .memory-date {
            color: #666;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .memory-question {
            font-size: 20px;
            color: #333;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .mood-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .mood-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border: 3px solid #f1f5f9;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
            min-width: 80px;
        }

        .mood-option:hover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .mood-option.selected {
            border-color: var(--primary-color);
            background: var(--primary-gradient);
            color: white;
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .mood-emoji {
            font-size: 40px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .mood-option:hover .mood-emoji {
            transform: scale(1.2) rotate(10deg);
        }

        .mood-option.selected .mood-emoji {
            transform: scale(1.3) rotate(15deg);
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
        }

        .mood-label {
            font-size: 12px;
            font-weight: bold;
            text-align: center;
        }

        .memory-textarea {
            width: 100%;
            min-height: 120px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 15px;
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
            transition: all 0.3s ease;
            margin-bottom: 25px;
            background: #fafafa;
        }

        .memory-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            background: white;
        }

        .memory-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .memory-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .memory-btn.primary {
            background: var(--primary-gradient);
            color: white;
        }

        .memory-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .memory-btn.secondary {
            background: #f1f5f9;
            color: #64748b;
        }

        .memory-btn.secondary:hover {
            background: #e2e8f0;
            transform: translateY(-2px);
        }

        /* ÿµŸÅÿ≠ÿ© ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™ */
        .memories-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary-gradient);
            z-index: 2500;
            display: none;
            overflow-y: auto;
        }

        .memories-page.show {
            display: block;
            animation: memoriesPageSlide 0.5s ease-out;
        }

        @keyframes memoriesPageSlide {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .memories-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .memories-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .memories-header h1 {
            color: var(--primary-color);
            font-size: 32px;
            margin: 0 0 10px 0;
            font-weight: bold;
        }

        .memories-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .memory-stat {
            text-align: center;
        }

        .memory-stat-number {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .memory-stat-label {
            font-size: 14px;
            color: #666;
        }

        .memories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .memory-item {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .memory-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .memory-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .memory-item-date {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 16px;
        }

        .memory-item-mood {
            font-size: 30px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .memory-item-text {
            color: #333;
            line-height: 1.6;
            font-size: 15px;
            margin-bottom: 15px;
        }

        .memory-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #666;
        }

        .memory-actions-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            display: flex;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }

        .close-memories-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .close-memories-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™ */
        .memory-celebration {
            animation: memoryCelebration 1s ease-in-out;
        }

        @keyframes memoryCelebration {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.05) rotate(2deg); }
            50% { transform: scale(1.1) rotate(-2deg); }
            75% { transform: scale(1.05) rotate(1deg); }
        }

        .memory-particle {
            position: absolute;
            pointer-events: none;
            z-index: 3001;
            font-size: 20px;
            animation: memoryParticleFloat 3s ease-out forwards;
        }

        @keyframes memoryParticleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(0.5) rotate(0deg);
            }
            50% {
                opacity: 1;
                transform: translateY(-40px) scale(1) rotate(180deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(1.5) rotate(360deg);
            }
        }

        /* ÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© */
        @media (max-width: 768px) {
            .memory-card {
                padding: 25px;
                margin: 20px;
            }
            
            .mood-selector {
                gap: 10px;
            }
            
            .mood-option {
                min-width: 60px;
                padding: 10px;
            }
            
            .mood-emoji {
                font-size: 30px;
            }
            
            .memories-grid {
                grid-template-columns: 1fr;
            }
        }

        /* === ÿ£ŸÜŸäŸÖŸäÿ¥ŸÜ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿßŸÑÿ∑ÿßÿ¶ÿ±ÿ© === */
        .flying-emoji {
            position: fixed;
            font-size: 40px;
            pointer-events: none;
            z-index: 1000;
            user-select: none;
        }

        /* ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ© */
        .fly-straight {
            animation: flyingStraight 4s ease-out forwards;
        }

        .fly-bounce {
            animation: flyingBounce 5s ease-out forwards;
        }

        .fly-spiral {
            animation: flyingSpiral 6s ease-out forwards;
        }

        .fly-zigzag {
            animation: flyingZigzag 5s ease-out forwards;
        }

        .fly-float {
            animation: flyingFloat 7s ease-out forwards;
        }

        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ∞ŸäŸÑ ŸÑŸÑÿ•ŸäŸÖŸàÿ¨Ÿä */
        .emoji-trail::after {
            content: attr(data-emoji);
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.5;
            font-size: 30px;
            animation: trailFade 1s ease-out infinite;
        }

        /* ÿ£ŸÜŸàÿßÿπ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ© */
        .emoji-laugh {
            filter: drop-shadow(0 0 10px rgba(255, 193, 7, 0.6));
        }

        .emoji-heart {
            filter: drop-shadow(0 0 10px rgba(255, 20, 147, 0.6));
        }

        .emoji-fire {
            filter: drop-shadow(0 0 10px rgba(255, 69, 0, 0.6));
        }

        .emoji-star {
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.6));
        }

        .emoji-party {
            filter: drop-shadow(0 0 10px rgba(138, 43, 226, 0.6));
        }

        /* ÿ≠ÿ±ŸÉÿßÿ™ ÿßŸÑÿ∑Ÿäÿ±ÿßŸÜ */
        @keyframes flyingStraight {
            0% {
                opacity: 1;
                transform: scale(0.5) rotate(0deg);
            }
            20% {
                opacity: 1;
                transform: scale(1) rotate(45deg);
            }
            100% {
                opacity: 0;
                transform: scale(1.5) rotate(360deg) translateX(100vw) translateY(-50vh);
            }
        }

        @keyframes flyingBounce {
            0% {
                opacity: 1;
                transform: scale(0.5) translateY(0);
            }
            10% {
                transform: scale(1) translateY(-30px);
            }
            20% {
                transform: scale(1.1) translateY(0);
            }
            30% {
                transform: scale(1) translateY(-20px);
            }
            40% {
                transform: scale(1.05) translateY(0);
            }
            50% {
                transform: scale(1) translateY(-15px);
            }
            60% {
                transform: scale(1.02) translateY(0);
            }
            70% {
                transform: scale(1) translateY(-10px);
            }
            80% {
                transform: scale(1.01) translateY(0);
            }
            90% {
                transform: scale(1) translateY(-5px);
            }
            100% {
                opacity: 0;
                transform: scale(1.5) translateY(-100vh) translateX(50vw);
            }
        }

        @keyframes flyingSpiral {
            0% {
                opacity: 1;
                transform: scale(0.5) rotate(0deg) translateX(0) translateY(0);
            }
            25% {
                opacity: 1;
                transform: scale(1) rotate(90deg) translateX(100px) translateY(-100px);
            }
            50% {
                opacity: 1;
                transform: scale(1.2) rotate(180deg) translateX(0) translateY(-200px);
            }
            75% {
                opacity: 1;
                transform: scale(1) rotate(270deg) translateX(-100px) translateY(-300px);
            }
            100% {
                opacity: 0;
                transform: scale(1.5) rotate(360deg) translateX(0) translateY(-400px);
            }
        }

        @keyframes flyingZigzag {
            0% {
                opacity: 1;
                transform: scale(0.5) translateX(0) translateY(0);
            }
            12.5% {
                transform: scale(0.8) translateX(50px) translateY(-50px);
            }
            25% {
                transform: scale(1) translateX(-30px) translateY(-100px);
            }
            37.5% {
                transform: scale(1.1) translateX(70px) translateY(-150px);
            }
            50% {
                transform: scale(1) translateX(-50px) translateY(-200px);
            }
            62.5% {
                transform: scale(1.05) translateX(80px) translateY(-250px);
            }
            75% {
                transform: scale(1) translateX(-40px) translateY(-300px);
            }
            87.5% {
                transform: scale(1.02) translateX(60px) translateY(-350px);
            }
            100% {
                opacity: 0;
                transform: scale(1.5) translateX(0) translateY(-400px);
            }
        }

        @keyframes flyingFloat {
            0% {
                opacity: 1;
                transform: scale(0.5) translateY(0) rotate(0deg);
            }
            10% {
                transform: scale(0.7) translateY(-20px) rotate(18deg);
            }
            20% {
                transform: scale(0.9) translateY(-35px) rotate(36deg);
            }
            30% {
                transform: scale(1) translateY(-45px) rotate(54deg);
            }
            40% {
                transform: scale(1.1) translateY(-50px) rotate(72deg);
            }
            50% {
                transform: scale(1.2) translateY(-60px) rotate(90deg);
            }
            60% {
                transform: scale(1.1) translateY(-80px) rotate(108deg);
            }
            70% {
                transform: scale(1) translateY(-120px) rotate(126deg);
            }
            80% {
                transform: scale(0.9) translateY(-180px) rotate(144deg);
            }
            90% {
                transform: scale(0.8) translateY(-260px) rotate(162deg);
            }
            100% {
                opacity: 0;
                transform: scale(0.5) translateY(-400px) rotate(180deg);
            }
        }

        @keyframes trailFade {
            0% {
                opacity: 0.5;
                transform: scale(1);
            }
            50% {
                opacity: 0.3;
                transform: scale(0.8);
            }
            100% {
                opacity: 0;
                transform: scale(0.5);
            }
        }
    </style>
</head>
<body class="gradient-bg">
    <!-- Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© -->
    <div id="chatScreen" class="min-h-screen p-4 flex items-center justify-center">
        <div class="chat-container max-w-7xl w-full mx-auto">
            <!-- ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä -->
            <div class="sidebar">
                <!-- ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ®ÿ≠ÿ´ -->
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™..." onkeyup="searchContacts(this.value)">
                </div>
                
                <!-- ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© -->
                <div class="flex border-b border-gray-200">
                    <button class="tab-btn active" onclick="switchTab('contacts')" data-tab="contacts">
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        ÿßŸÑÿ£ÿ¥ÿÆÿßÿµ
                    </button>
                    <button class="tab-btn" onclick="switchTab('groups')" data-tab="groups">
                        <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        ÿßŸÑÿ¨ÿ±Ÿàÿ®ÿßÿ™
                    </button>
                </div>
                
                <!-- ŸÇÿßÿ¶ŸÖÿ© ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ -->
                <div id="contactsList" class="flex-1 overflow-y-auto tab-content active" data-content="contacts">
                    <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ŸÄ JavaScript -->
                </div>
                
                <!-- ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ¨ÿ±Ÿàÿ®ÿßÿ™ -->
                <div id="groupsList" class="flex-1 overflow-y-auto tab-content" data-content="groups">
                    <div class="p-4 text-center text-gray-500">
                        <div class="text-4xl mb-2">üë•</div>
                        <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ¨ÿ±Ÿàÿ®ÿßÿ™ ÿ®ÿπÿØ</p>
                    </div>
                </div>
                
                <!-- ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ -->
                <div class="p-4 border-t border-gray-200">
                    <div class="flex items-center gap-3">
                        <div class="avatar relative cursor-pointer" title="ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä">
                            <span id="userAvatar">A</span>
                            <div class="online-indicator" id="userOnlineIndicator"></div>
                        </div>
                        <div class="flex-1">
                            <div class="font-semibold" id="currentUser">ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</div>
                            <div class="text-sm text-gray-500" id="currentUserStatus">ŸÖÿ™ÿµŸÑ</div>
                        </div>
                        <div class="flex gap-1">
                            <button onclick="showDailyMemoryPrompt()" class="text-purple-500 hover:text-purple-700 transition-all hover:scale-110" title="ÿ∞ŸÉÿ±Ÿäÿßÿ™Ÿä ÿßŸÑŸäŸàŸÖŸäÿ©">
                                üìù
                            </button>
                            <button onclick="showNotification('ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±! ‚öôÔ∏è')" class="text-blue-500 hover:text-blue-700 transition-all hover:scale-110" title="ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™">
                                ‚öôÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿØÿ±ÿØÿ¥ÿ© -->
            <div class="chat-area">
                <!-- ÿ±ÿ£ÿ≥ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© -->
                <div class="chat-header">
                    <div class="avatar relative" style="width: 60px; height: 60px; font-size: 24px;">
                        <span id="chatAvatar">ÿü</span>
                        <div class="online-indicator" id="chatOnlineIndicator"></div>
                    </div>
                    <div class="flex-1">
                        <div class="font-bold text-lg" id="chatName">ÿßÿÆÿ™ÿ± ŸÖÿ≠ÿßÿØÿ´ÿ©</div>
                        <div class="text-sm text-gray-500" id="chatStatus">ŸÑŸÑÿ®ÿØÿ° ŸÅŸä ÿßŸÑÿØÿ±ÿØÿ¥ÿ©</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="showMemoriesPage()" class="p-2 hover:bg-gray-100 rounded-full transition-all" title="ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ©">
                            üìñ
                        </button>
                        <button onclick="showNotification('ÿßŸÑŸÖŸÉÿßŸÑŸÖÿßÿ™ ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±! üìû')" class="p-2 hover:bg-gray-100 rounded-full transition-all" title="ŸÖŸÉÿßŸÑŸÖÿ© ÿµŸàÿ™Ÿäÿ©">
                            üìû
                        </button>
                        <button onclick="showNotification('ÿßŸÑŸÖŸÉÿßŸÑŸÖÿßÿ™ ÿßŸÑŸÖÿ±ÿ¶Ÿäÿ© ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±! üìπ')" class="p-2 hover:bg-gray-100 rounded-full transition-all" title="ŸÖŸÉÿßŸÑŸÖÿ© ŸÖÿ±ÿ¶Ÿäÿ©">
                            üìπ
                        </button>
                    </div>
                </div>
                
                <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ -->
                <div class="message-container" id="messageContainer">
                    <div class="text-center text-gray-500 mt-20">
                        <div class="text-6xl mb-4">üí¨</div>
                        <h3 class="text-xl font-semibold mb-2">ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿßŸÑŸÖÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÖÿ™ÿ∑Ÿàÿ±!</h3>
                        <p>ÿßÿÆÿ™ÿ± ŸÖÿ≠ÿßÿØÿ´ÿ© ŸÖŸÜ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä ŸÑŸÑÿ®ÿØÿ°</p>
                        <div class="mt-4 text-sm">
                            <p>üí° ŸÜÿµŸäÿ≠ÿ©: ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ£Ÿä ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ≠ÿ™ŸàŸä ÿπŸÑŸâ ŸÉŸÑŸÖÿßÿ™ ŸÖÿ´ŸÑ "ŸáŸáŸáŸáŸá" ÿ£Ÿà "ÿ£ÿ≠ÿ®ŸÉ" ŸÑÿ™ÿ±Ÿâ ÿßŸÑÿ≥ÿ≠ÿ±!</p>
                        </div>
                    </div>
                </div>
                
                <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÉÿ™ÿßÿ®ÿ© -->
                <div class="input-area">
                    <button class="file-btn" onclick="showNotification('ÿßŸÑŸÖŸÑŸÅÿßÿ™ ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±! üìé')" title="ÿ•ÿ±ŸÅÿßŸÇ ŸÖŸÑŸÅ">
                        üìé
                    </button>
                    <button class="file-btn" onclick="addInteractiveTestMessage()" title="ÿ±ÿ≥ÿßŸÑÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ©">
                        üíå
                    </button>
                    <button class="file-btn" onclick="launchRandomEmoji()" title="ÿ•ŸäŸÖŸàÿ¨Ÿä ÿ∑ÿßÿ¶ÿ±ÿ©">
                        üöÄ
                    </button>
                    <button class="file-btn" onclick="launchEmojiStorm('üéâ', 8)" title="ÿπÿßÿµŸÅÿ© ÿ•ŸäŸÖŸàÿ¨Ÿä">
                        üå™Ô∏è
                    </button>
                    <button class="file-btn" onclick="showGiftMenu()" title="ÿ•ÿ±ÿ≥ÿßŸÑ ŸáÿØŸäÿ©">
                        üéÅ
                    </button>
                    <textarea class="message-input" id="messageInput" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ ŸáŸÜÿß..." rows="1" onkeypress="handleKeyPress(event)" oninput="adjustTextareaHeight(this)"></textarea>
                    <button class="send-btn" onclick="sendMessage()" title="ÿ•ÿ±ÿ≥ÿßŸÑ">
                        ‚û§
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸáÿØÿßŸäÿß -->
    <div id="giftMenu" class="gift-menu">
        <h3>üéÅ ÿßÿÆÿ™ÿ± ŸáÿØŸäÿ©</h3>
        <div class="gift-options">
            <div class="gift-option" onclick="sendGift('üåπ', 'Ÿàÿ±ÿØÿ©', 'rose')">
                <div class="gift-emoji">üåπ</div>
                <div class="gift-name">Ÿàÿ±ÿØÿ©</div>
            </div>
            <div class="gift-option" onclick="sendGift('üç´', 'ÿ¥ŸàŸÉŸàŸÑÿßÿ™ÿ©', 'chocolate')">
                <div class="gift-emoji">üç´</div>
                <div class="gift-name">ÿ¥ŸàŸÉŸàŸÑÿßÿ™ÿ©</div>
            </div>
            <div class="gift-option" onclick="sendGift('‚ú®', 'ŸÜÿ¨ŸÖÿ©', 'star')">
                <div class="gift-emoji">‚ú®</div>
                <div class="gift-name">ŸÜÿ¨ŸÖÿ©</div>
            </div>
            <div class="gift-option" onclick="sendGift('‚ù§Ô∏è', 'ŸÇŸÑÿ®', 'heart')">
                <div class="gift-emoji">‚ù§Ô∏è</div>
                <div class="gift-name">ŸÇŸÑÿ®</div>
            </div>
            <div class="gift-option" onclick="sendGift('üíé', 'ŸÖÿßÿ≥ÿ©', 'diamond')">
                <div class="gift-emoji">üíé</div>
                <div class="gift-name">ŸÖÿßÿ≥ÿ©</div>
            </div>
            <div class="gift-option" onclick="sendGift('üëë', 'ÿ™ÿßÿ¨', 'crown')">
                <div class="gift-emoji">üëë</div>
                <div class="gift-name">ÿ™ÿßÿ¨</div>
            </div>
        </div>
    </div>

    <!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ© -->
    <div id="memoryPopup" class="memory-popup">
        <div class="memory-card">
            <div class="memory-header">
                <h2>üìñ ÿ∞ŸÉÿ±Ÿäÿßÿ™Ÿä ÿßŸÑŸäŸàŸÖŸäÿ©</h2>
                <div class="memory-date" id="memoryDate"></div>
                <div class="memory-question">ŸÉŸäŸÅ ŸÉÿßŸÜ ŸäŸàŸÖŸÉ ÿßŸÑŸäŸàŸÖÿü üòä</div>
            </div>
            
            <div class="mood-selector">
                <div class="mood-option" onclick="selectMood(this, 'üòä', 'ÿ≥ÿπŸäÿØ')">
                    <div class="mood-emoji">üòä</div>
                    <div class="mood-label">ÿ≥ÿπŸäÿØ</div>
                </div>
                <div class="mood-option" onclick="selectMood(this, 'üò¢', 'ÿ≠ÿ≤ŸäŸÜ')">
                    <div class="mood-emoji">üò¢</div>
                    <div class="mood-label">ÿ≠ÿ≤ŸäŸÜ</div>
                </div>
                <div class="mood-option" onclick="selectMood(this, 'üò¥', 'ŸÖÿ™ÿπÿ®')">
                    <div class="mood-emoji">üò¥</div>
                    <div class="mood-label">ŸÖÿ™ÿπÿ®</div>
                </div>
                <div class="mood-option" onclick="selectMood(this, 'üòç', 'ŸÖÿ™ÿ≠ŸÖÿ≥')">
                    <div class="mood-emoji">üòç</div>
                    <div class="mood-label">ŸÖÿ™ÿ≠ŸÖÿ≥</div>
                </div>
                <div class="mood-option" onclick="selectMood(this, 'üò§', 'ÿ∫ÿßÿ∂ÿ®')">
                    <div class="mood-emoji">üò§</div>
                    <div class="mood-label">ÿ∫ÿßÿ∂ÿ®</div>
                </div>
                <div class="mood-option" onclick="selectMood(this, 'ü§î', 'ŸÖŸÅŸÉÿ±')">
                    <div class="mood-emoji">ü§î</div>
                    <div class="mood-label">ŸÖŸÅŸÉÿ±</div>
                </div>
            </div>
            
            <textarea 
                id="memoryText" 
                class="memory-textarea" 
                placeholder="ÿßŸÉÿ™ÿ® ÿπŸÜ ŸäŸàŸÖŸÉ... ŸÖÿß ÿßŸÑÿ∞Ÿä ÿ≠ÿØÿ´ÿü ŸÉŸäŸÅ ÿ¥ÿπÿ±ÿ™ÿü ŸÖÿß ÿßŸÑÿ∞Ÿä ÿ™ÿπŸÑŸÖÿ™Ÿáÿü üìù"
            ></textarea>
            
            <div class="memory-actions">
                <button class="memory-btn secondary" onclick="closeMemoryPopup()">
                    ÿ™ÿ¨ÿßŸáŸÑ
                </button>
                <button class="memory-btn primary" onclick="saveMemory()">
                    ÿ≠ŸÅÿ∏ ÿßŸÑÿ∞ŸÉÿ±Ÿâ ‚ú®
                </button>
            </div>
        </div>
    </div>

    <!-- ÿµŸÅÿ≠ÿ© ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™ -->
    <div id="memoriesPage" class="memories-page">
        <div class="memories-container">
            <div class="memories-header">
                <h1>üìñ ÿ∞ŸÉÿ±Ÿäÿßÿ™Ÿä ÿßŸÑÿ¥ÿÆÿµŸäÿ©</h1>
                <p>ŸÖÿ¨ŸÖŸàÿπÿ© ŸÖŸÜ ÿßŸÑŸÑÿ≠ÿ∏ÿßÿ™ ŸàÿßŸÑŸÖÿ¥ÿßÿπÿ± ÿßŸÑÿ™Ÿä ÿπÿ¥ÿ™Ÿáÿß</p>
                <div class="memories-stats">
                    <div class="memory-stat">
                        <div class="memory-stat-number" id="totalMemories">0</div>
                        <div class="memory-stat-label">ÿ∞ŸÉÿ±Ÿâ</div>
                    </div>
                    <div class="memory-stat">
                        <div class="memory-stat-number" id="happyDays">0</div>
                        <div class="memory-stat-label">ŸäŸàŸÖ ÿ≥ÿπŸäÿØ</div>
                    </div>
                    <div class="memory-stat">
                        <div class="memory-stat-number" id="currentStreak">0</div>
                        <div class="memory-stat-label">ŸäŸàŸÖ ŸÖÿ™ÿ™ÿßŸÑŸä</div>
                    </div>
                </div>
            </div>
            
            <div id="memoriesGrid" class="memories-grid">
                <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ŸÄ JavaScript -->
            </div>
            
            <div class="memory-actions-bar">
                <button class="close-memories-btn" onclick="closeMemoriesPage()">
                    ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿØÿ±ÿØÿ¥ÿ© üí¨
                </button>
            </div>
        </div>
    </div>

    <script>
        // ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿπÿßŸÖÿ©
        let currentChat = null;
        let contacts = [
            { id: 1, name: 'ÿ£ÿ≠ŸÖÿØ ŸÖÿ≠ŸÖÿØ', avatar: 'ÿ£', status: 'online', lastSeen: 'ŸÖÿ™ÿµŸÑ ÿßŸÑÿ¢ŸÜ', phone: '+966501234567' },
            { id: 2, name: 'ŸÅÿßÿ∑ŸÖÿ© ÿπŸÑŸä', avatar: 'ŸÅ', status: 'away', lastSeen: 'ÿ¢ÿÆÿ± ÿ∏ŸáŸàÿ± ŸÖŸÜÿ∞ 5 ÿØŸÇÿßÿ¶ŸÇ', phone: '+966507654321' },
            { id: 3, name: 'ŸÖÿ≠ŸÖÿØ ÿ≥ÿßŸÑŸÖ', avatar: 'ŸÖ', status: 'busy', lastSeen: 'ÿ¢ÿÆÿ± ÿ∏ŸáŸàÿ± ŸÖŸÜÿ∞ ÿ≥ÿßÿπÿ©', phone: '+966512345678' },
            { id: 4, name: 'ŸÜŸàÿ±ÿß ÿ£ÿ≠ŸÖÿØ', avatar: 'ŸÜ', status: 'online', lastSeen: 'ŸÖÿ™ÿµŸÑÿ© ÿßŸÑÿ¢ŸÜ', phone: '+966598765432' }
        ];
        
        let messages = {};
        let currentUser = { name: 'ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ', avatar: 'A', status: 'online' };

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ
        function loadContacts() {
            const contactsList = document.getElementById('contactsList');
            contactsList.innerHTML = '';
            
            contacts.forEach((contact, index) => {
                const contactElement = document.createElement('div');
                contactElement.className = 'contact-item';
                contactElement.setAttribute('data-contact-id', contact.id);
                
                const statusEmoji = {
                    'online': 'üü¢',
                    'away': 'üü°',
                    'busy': 'üî¥',
                    'invisible': '‚ö´'
                };
                
                contactElement.innerHTML = `
                    <div class="avatar">
                        <span>${contact.avatar}</span>
                        <div class="online-indicator" style="display: ${contact.status === 'online' ? 'block' : 'none'}"></div>
                    </div>
                    <div class="flex-1">
                        <div class="font-semibold">${contact.name}</div>
                        <div class="text-sm text-gray-500">${contact.lastSeen}</div>
                    </div>
                    <div class="text-xs text-gray-400">
                        ${statusEmoji[contact.status]}
                    </div>
                `;
                
                // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ ÿ®ÿ∑ÿ±ŸäŸÇÿ© ÿµÿ≠Ÿäÿ≠ÿ©
                contactElement.addEventListener('click', function() {
                    openChat(contact);
                });
                
                contactsList.appendChild(contactElement);
            });
        }

        // ŸÅÿ™ÿ≠ ŸÖÿ≠ÿßÿØÿ´ÿ©
        function openChat(contact) {
            currentChat = contact;
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿ±ÿ£ÿ≥ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©
            document.getElementById('chatAvatar').textContent = contact.avatar;
            document.getElementById('chatName').textContent = contact.name;
            document.getElementById('chatStatus').textContent = contact.lastSeen;
            document.getElementById('chatOnlineIndicator').style.display = contact.status === 'online' ? 'block' : 'none';
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ
            loadMessages(contact.id);
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä
            document.querySelectorAll('.contact-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿπŸÜÿµÿ± ÿßŸÑÿµÿ≠Ÿäÿ≠ Ÿàÿ™ŸÅÿπŸäŸÑŸá
            const contactElement = document.querySelector(`[data-contact-id="${contact.id}"]`);
            if (contactElement) {
                contactElement.classList.add('active');
            }
            
            showNotification(`ÿ™ŸÖ ŸÅÿ™ÿ≠ ŸÖÿ≠ÿßÿØÿ´ÿ© ${contact.name}! üí¨`);
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ
        function loadMessages(contactId) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.innerHTML = '';
            
            if (!messages[contactId]) {
                messages[contactId] = [
                    { id: 1, text: 'ŸÖÿ±ÿ≠ÿ®ÿßŸã! ŸÉŸäŸÅ ÿ≠ÿßŸÑŸÉÿü', sent: false, time: '10:30', rating: 0, ratingCount: 0 },
                    { id: 2, text: 'ÿ£ŸáŸÑÿßŸã Ÿàÿ≥ŸáŸÑÿßŸã! ÿ®ÿÆŸäÿ± ŸàÿßŸÑÿ≠ŸÖÿØ ŸÑŸÑŸá ŸáŸáŸáŸáŸá üòÇ', sent: true, time: '10:32', rating: 4, ratingCount: 3 },
                    { id: 3, text: 'ŸÖÿß ÿ£ÿÆÿ®ÿßÿ±ŸÉÿü ÿ£ÿ≠ÿ®ŸÉ ŸÉÿ´Ÿäÿ±ÿßŸã ‚ù§Ô∏è', sent: false, time: '10:33', rating: 5, ratingCount: 2 },
                    { id: 4, text: 'ŸàÿßŸà! Ÿáÿ∞ÿß ÿ±ÿßÿ¶ÿπ ÿ¨ÿØÿßŸã ü§©', sent: true, time: '10:34', rating: 3, ratingCount: 1 },
                    { id: 5, text: 'ÿ£ŸÜÿß ÿ¨ÿßÿ¶ÿπ ÿ¨ÿØÿßŸã üçï', sent: false, time: '10:35', rating: 2, ratingCount: 1 }
                ];
            }
            
            messages[contactId].forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = `message ${message.sent ? 'sent' : 'received'}`;
                messageElement.setAttribute('data-message-id', message.id);
                
                if (message.isGame) {
                    // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ£ŸÑÿπÿßÿ® ŸàÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸä
                    messageElement.innerHTML = `
                        <div class="message-bubble" style="max-width: 90%; background: ${message.sent ? 'var(--primary-gradient)' : 'white'}; ${message.sent ? 'color: white;' : ''}">
                            ${message.text}
                            <div class="text-xs opacity-70 mt-2">${message.time}</div>
                        </div>
                    `;
                } else {
                    // ÿπÿ±ÿ∂ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿπÿßÿØŸäÿ© ŸÖÿπ ÿßŸÑÿ™ŸÅÿßÿπŸÑ ŸàÿßŸÑŸÜÿ¨ŸàŸÖ
                    const processedText = makeTextInteractive(message.text);
                    const starRating = createStarRating(message.rating || 0, message.ratingCount || 0, message.id);
                    
                    messageElement.innerHTML = `
                        <div class="message-bubble interactive-message" onclick="handleMessageClick(this, '${message.text.replace(/'/g, "\\'")}')">
                            ${processedText}
                            <div class="text-xs opacity-70 mt-1">${message.time}</div>
                            ${starRating}
                        </div>
                    `;
                }
                
                messageContainer.appendChild(messageElement);
            });
            
            messageContainer.scrollTop = messageContainer.scrollHeight;
        }

        // ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿ∏ÿßŸÖ ÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÜÿ¨ŸàŸÖ
        function createStarRating(currentRating, ratingCount, messageId) {
            const stars = [];
            for (let i = 1; i <= 5; i++) {
                const starClass = i <= currentRating ? 'filled' : 'empty';
                stars.push(`<span class="star ${starClass}" data-rating="${i}">‚≠ê</span>`);
            }
            
            const countText = ratingCount > 0 ? `<span class="rating-count">${ratingCount}</span>` : '';
            
            return `
                <div class="star-rating" onclick="event.stopPropagation(); showRatingPopup(this, ${messageId})" data-message-id="${messageId}">
                    ${countText}${stars.join('')}
                </div>
            `;
        }

        // === Ÿàÿ∏ÿßÿ¶ŸÅ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© ===
        
        // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÜÿµ ŸÑÿ¨ÿπŸÑŸá ÿ™ŸÅÿßÿπŸÑŸä
        function makeTextInteractive(text) {
            // ŸÇÿßŸÖŸàÿ≥ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© ŸàÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ∑ÿ© ÿ®Ÿáÿß
            const interactiveWords = {
                // ŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ∂ÿ≠ŸÉ
                'ŸáŸáŸáŸáŸá': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'ŸáŸáŸáŸá': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'ŸáŸáŸá': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'ŸáŸá': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'ŸÑŸàŸÑ': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'LOL': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'haha': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'hahaha': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                
                // ŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ≠ÿ®
                'ÿ£ÿ≠ÿ®ŸÉ': { effect: 'love', bubbles: ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó'] },
                'ÿ≠ÿ®Ÿäÿ®Ÿä': { effect: 'love', bubbles: ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó'] },
                'ÿ≠ÿ®Ÿäÿ®ÿ™Ÿä': { effect: 'love', bubbles: ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó'] },
                'ÿπÿ¥ŸÇŸÉ': { effect: 'love', bubbles: ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó'] },
                'love': { effect: 'love', bubbles: ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó'] },
                
                // ŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ∫ÿ∂ÿ®
                'ÿ∫ÿßÿ∂ÿ®': { effect: 'angry', bubbles: ['üò°', 'ü§¨', 'üí¢'] },
                'ÿ≤ÿπŸÑÿßŸÜ': { effect: 'angry', bubbles: ['üò°', 'ü§¨', 'üí¢'] },
                'ŸÖÿ¨ŸÜŸàŸÜ': { effect: 'angry', bubbles: ['üò°', 'ü§¨', 'üí¢'] },
                'angry': { effect: 'angry', bubbles: ['üò°', 'ü§¨', 'üí¢'] },
                
                // ŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ≠ÿ≤ŸÜ
                'ÿ≠ÿ≤ŸäŸÜ': { effect: 'sad', bubbles: ['üò¢', 'üò≠', 'üíî'] },
                'sad': { effect: 'sad', bubbles: ['üò¢', 'üò≠', 'üíî'] },
                
                // ŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ•ÿπÿ¨ÿßÿ®
                'ŸàÿßŸà': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                'ÿ±ÿßÿ¶ÿπ': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                'ÿ¨ŸÖŸäŸÑ': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                'ŸÖÿ∞ŸáŸÑ': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                'wow': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                'amazing': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                
                // ŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ
                'ŸÖÿ®ÿ±ŸàŸÉ': { effect: 'party', bubbles: ['üéâ', 'üéä', 'ü•≥', 'üéà'] },
                'ÿ™ŸáÿßŸÜŸäŸÜÿß': { effect: 'party', bubbles: ['üéâ', 'üéä', 'ü•≥', 'üéà'] },
                'Ÿäÿß ŸáŸÑÿß': { effect: 'party', bubbles: ['üéâ', 'üéä', 'ü•≥', 'üéà'] },
                'party': { effect: 'party', bubbles: ['üéâ', 'üéä', 'ü•≥', 'üéà'] },
                
                // ŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÜŸàŸÖ
                'ŸÜÿπÿ≥ÿßŸÜ': { effect: 'sleep', bubbles: ['üò¥', 'üí§', 'üõå'] },
                'ŸÜÿßŸäŸÖ': { effect: 'sleep', bubbles: ['üò¥', 'üí§', 'üõå'] },
                'ÿ™ÿπÿ®ÿßŸÜ': { effect: 'sleep', bubbles: ['üò¥', 'üí§', 'üõå'] },
                'sleepy': { effect: 'sleep', bubbles: ['üò¥', 'üí§', 'üõå'] },
                
                // ŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ∑ÿπÿßŸÖ
                'ÿ¨ÿßÿ¶ÿπ': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] },
                'ÿ¨ŸàÿπÿßŸÜ': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] },
                'ÿ∑ÿπÿßŸÖ': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] },
                'ÿ£ŸÉŸÑ': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] },
                'hungry': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] },
                'food': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] }
            };
            
            let processedText = text;
            
            // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© Ÿàÿ™ŸÖŸäŸäÿ≤Ÿáÿß
            Object.keys(interactiveWords).forEach(word => {
                const regex = new RegExp(`\\b${word}\\b`, 'gi');
                processedText = processedText.replace(regex, `<span class="word-highlight interactive-word" data-word="${word}">${word}</span>`);
            });
            
            return processedText;
        }

        // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
        function handleMessageClick(messageElement, originalText) {
            // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÅŸä ÿßŸÑŸÜÿµ
            const interactiveWords = {
                'ŸáŸáŸáŸáŸá': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'ŸáŸáŸáŸá': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'ŸáŸáŸá': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'ŸáŸá': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'ŸÑŸàŸÑ': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'LOL': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'haha': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'hahaha': { effect: 'laugh', bubbles: ['üòÇ', 'ü§£', 'üòÜ'] },
                'ÿ£ÿ≠ÿ®ŸÉ': { effect: 'love', bubbles: ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó'] },
                'ÿ≠ÿ®Ÿäÿ®Ÿä': { effect: 'love', bubbles: ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó'] },
                'ÿ≠ÿ®Ÿäÿ®ÿ™Ÿä': { effect: 'love', bubbles: ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó'] },
                'ÿπÿ¥ŸÇŸÉ': { effect: 'love', bubbles: ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó'] },
                'love': { effect: 'love', bubbles: ['‚ù§Ô∏è', 'üíï', 'üíñ', 'üíó'] },
                'ÿ∫ÿßÿ∂ÿ®': { effect: 'angry', bubbles: ['üò°', 'ü§¨', 'üí¢'] },
                'ÿ≤ÿπŸÑÿßŸÜ': { effect: 'angry', bubbles: ['üò°', 'ü§¨', 'üí¢'] },
                'ŸÖÿ¨ŸÜŸàŸÜ': { effect: 'angry', bubbles: ['üò°', 'ü§¨', 'üí¢'] },
                'angry': { effect: 'angry', bubbles: ['üò°', 'ü§¨', 'üí¢'] },
                'ÿ≠ÿ≤ŸäŸÜ': { effect: 'sad', bubbles: ['üò¢', 'üò≠', 'üíî'] },
                'sad': { effect: 'sad', bubbles: ['üò¢', 'üò≠', 'üíî'] },
                'ŸàÿßŸà': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                'ÿ±ÿßÿ¶ÿπ': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                'ÿ¨ŸÖŸäŸÑ': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                'ŸÖÿ∞ŸáŸÑ': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                'wow': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                'amazing': { effect: 'wow', bubbles: ['ü§©', 'üòç', 'üî•', 'üíØ'] },
                'ŸÖÿ®ÿ±ŸàŸÉ': { effect: 'party', bubbles: ['üéâ', 'üéä', 'ü•≥', 'üéà'] },
                'ÿ™ŸáÿßŸÜŸäŸÜÿß': { effect: 'party', bubbles: ['üéâ', 'üéä', 'ü•≥', 'üéà'] },
                'Ÿäÿß ŸáŸÑÿß': { effect: 'party', bubbles: ['üéâ', 'üéä', 'ü•≥', 'üéà'] },
                'party': { effect: 'party', bubbles: ['üéâ', 'üéä', 'ü•≥', 'üéà'] },
                'ŸÜÿπÿ≥ÿßŸÜ': { effect: 'sleep', bubbles: ['üò¥', 'üí§', 'üõå'] },
                'ŸÜÿßŸäŸÖ': { effect: 'sleep', bubbles: ['üò¥', 'üí§', 'üõå'] },
                'ÿ™ÿπÿ®ÿßŸÜ': { effect: 'sleep', bubbles: ['üò¥', 'üí§', 'üõå'] },
                'sleepy': { effect: 'sleep', bubbles: ['üò¥', 'üí§', 'üõå'] },
                'ÿ¨ÿßÿ¶ÿπ': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] },
                'ÿ¨ŸàÿπÿßŸÜ': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] },
                'ÿ∑ÿπÿßŸÖ': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] },
                'ÿ£ŸÉŸÑ': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] },
                'hungry': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] },
                'food': { effect: 'food', bubbles: ['üçï', 'üçî', 'üçü', 'üòã'] }
            };
            
            // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£ŸàŸÑ ŸÉŸÑŸÖÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÅŸä ÿßŸÑŸÜÿµ
            let foundWord = null;
            let foundEffect = null;
            
            Object.keys(interactiveWords).forEach(word => {
                if (originalText.toLowerCase().includes(word.toLowerCase()) && !foundWord) {
                    foundWord = word;
                    foundEffect = interactiveWords[word];
                }
            });
            
            if (foundEffect) {
                // ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ± ÿπŸÑŸâ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
                applyMessageEffect(messageElement, foundEffect.effect);
                
                // ÿ•ŸÜÿ¥ÿßÿ° ŸÅŸÇÿßÿπÿßÿ™ ÿßŸÑÿ™ŸÅÿßÿπŸÑ
                createReactionBubbles(messageElement, foundEffect.bubbles);
                
                // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸáÿ™ÿ≤ÿßÿ≤ ÿÆŸÅŸäŸÅ (ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ™ÿßÿ≠ÿßŸã)
                if (navigator.vibrate) {
                    navigator.vibrate(100);
                }
                
                // ÿ•ÿ∏Ÿáÿßÿ± ÿ•ÿ¥ÿπÿßÿ± ÿ™ŸÅÿßÿπŸÑŸä
                showInteractiveNotification(foundWord, foundEffect.effect);
            } else {
                // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿä ŸÑŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿπÿßÿØŸäÿ©
                messageElement.classList.add('vibrate-effect');
                setTimeout(() => {
                    messageElement.classList.remove('vibrate-effect');
                }, 300);
                
                // ŸÅŸÇÿßÿπÿßÿ™ ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
                createReactionBubbles(messageElement, ['‚ú®', 'üí´', '‚≠ê']);
            }
        }

        // ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ± ÿπŸÑŸâ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
        function applyMessageEffect(messageElement, effectType) {
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
            messageElement.classList.remove('laugh-effect', 'love-effect', 'angry-effect', 'sad-effect', 'wow-effect', 'party-effect', 'sleep-effect', 'food-effect');
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ¨ÿØŸäÿØ
            messageElement.classList.add(effectType + '-effect');
            
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿπÿØ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿ≠ÿ±ŸÉÿ©
            setTimeout(() => {
                messageElement.classList.remove(effectType + '-effect');
            }, effectType === 'party' ? 3000 : effectType === 'sleep' ? 2000 : 1000);
        }

        // ÿ•ŸÜÿ¥ÿßÿ° ŸÅŸÇÿßÿπÿßÿ™ ÿßŸÑÿ™ŸÅÿßÿπŸÑ
        function createReactionBubbles(messageElement, bubbleEmojis) {
            const numBubbles = Math.min(bubbleEmojis.length, 5);
            
            for (let i = 0; i < numBubbles; i++) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'reaction-bubble';
                    bubble.textContent = bubbleEmojis[Math.floor(Math.random() * bubbleEmojis.length)];
                    
                    // ŸÖŸàÿ∂ÿπ ÿπÿ¥Ÿàÿßÿ¶Ÿä ÿ≠ŸàŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
                    const rect = messageElement.getBoundingClientRect();
                    const randomX = Math.random() * 100 - 50; // ŸÖŸÜ -50 ÿ•ŸÑŸâ 50
                    const randomY = Math.random() * 30 - 15; // ŸÖŸÜ -15 ÿ•ŸÑŸâ 15
                    
                    bubble.style.left = (rect.width / 2 + randomX) + 'px';
                    bubble.style.top = (rect.height / 2 + randomY) + 'px';
                    
                    messageElement.appendChild(bubble);
                    
                    // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÅŸÇÿßÿπÿ© ÿ®ÿπÿØ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿ≠ÿ±ŸÉÿ©
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.parentNode.removeChild(bubble);
                        }
                    }, 2000);
                }, i * 200); // ÿ™ÿ£ÿÆŸäÿ± ÿ®ŸäŸÜ ÿßŸÑŸÅŸÇÿßÿπÿßÿ™
            }
        }

        // ÿ•ÿ∏Ÿáÿßÿ± ÿ•ÿ¥ÿπÿßÿ± ÿ™ŸÅÿßÿπŸÑŸä
        function showInteractiveNotification(word, effect) {
            const messages = {
                laugh: `üòÇ ŸáŸáŸáŸáŸáŸá! ŸÉŸÑŸÖÿ© "${word}" ÿ¨ÿπŸÑÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ∂ÿ≠ŸÉ!`,
                love: `‚ù§Ô∏è ÿ£ŸàŸàŸá! ŸÉŸÑŸÖÿ© "${word}" ŸÖŸÑÿ£ÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ®ÿßŸÑÿ≠ÿ®!`,
                angry: `üò° ÿ£ŸàŸá ŸÑÿß! ŸÉŸÑŸÖÿ© "${word}" ÿ¨ÿπŸÑÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ∫ÿßÿ∂ÿ®ÿ©!`,
                sad: `üò¢ ÿ£ŸàŸá... ŸÉŸÑŸÖÿ© "${word}" ÿ¨ÿπŸÑÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ≠ÿ≤ŸäŸÜÿ©`,
                wow: `ü§© ŸàÿßŸà! ŸÉŸÑŸÖÿ© "${word}" ÿ£ÿ®Ÿáÿ±ÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©!`,
                party: `üéâ Ÿäÿß ŸáŸÑÿß! ŸÉŸÑŸÖÿ© "${word}" ÿ®ÿØÿ£ÿ™ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ!`,
                sleep: `üò¥ ÿ≤ÿ≤ÿ≤ÿ≤... ŸÉŸÑŸÖÿ© "${word}" ÿ¨ÿπŸÑÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ŸÜÿπÿ≥ÿßŸÜÿ©`,
                food: `üòã ŸäŸÖ ŸäŸÖ! ŸÉŸÑŸÖÿ© "${word}" ÿ¨ÿπŸÑÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ¨ÿßÿ¶ÿπÿ©!`
            };
            
            const message = messages[effect] || `‚ú® ŸÉŸÑŸÖÿ© "${word}" ÿ¨ÿπŸÑÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ™ŸÅÿßÿπŸÑ!`;
            showNotification(message);
        }

        // ÿ•ÿ∂ÿßŸÅÿ© ÿ±ÿ≥ÿßŸÑÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ© ÿ™ÿ¨ÿ±Ÿäÿ®Ÿäÿ©
        function addInteractiveTestMessage() {
            if (!currentChat) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ£ŸàŸÑÿßŸã!', 'error');
                return;
            }
            
            const testMessages = [
                'ŸáŸáŸáŸáŸáŸáŸá Ÿáÿ∞ÿß ŸÖÿ∂ÿ≠ŸÉ ÿ¨ÿØÿßŸã! üòÇ',
                'ÿ£ÿ≠ÿ®ŸÉ ŸÉÿ´Ÿäÿ±ÿßŸã Ÿäÿß ÿ≠ÿ®Ÿäÿ®Ÿä ‚ù§Ô∏è',
                'ŸàÿßŸà! Ÿáÿ∞ÿß ÿ±ÿßÿ¶ÿπ ŸàŸÖÿ∞ŸáŸÑ! ü§©',
                'ŸÖÿ®ÿ±ŸàŸÉ ÿπŸÑŸâ ÿßŸÑŸÜÿ¨ÿßÿ≠! üéâ',
                'ÿ£ŸÜÿß ÿ¨ÿßÿ¶ÿπ ÿ¨ÿØÿßŸãÿå ÿ£ÿ±ŸäÿØ ÿ∑ÿπÿßŸÖ üçï',
                'ÿ£ŸÜÿß ŸÜÿπÿ≥ÿßŸÜ Ÿàÿ™ÿπÿ®ÿßŸÜ üò¥',
                'ÿ£ŸÜÿß ÿ∫ÿßÿ∂ÿ® Ÿàÿ≤ÿπŸÑÿßŸÜ ŸÖŸÜŸÉ! üò°',
                'ÿ£ŸÜÿß ÿ≠ÿ≤ŸäŸÜ ÿ¨ÿØÿßŸã ÿßŸÑŸäŸàŸÖ üò¢'
            ];
            
            const randomMessage = testMessages[Math.floor(Math.random() * testMessages.length)];
            
            const testMessage = {
                id: Date.now(),
                text: randomMessage,
                sent: true,
                time: new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),
                timestamp: Date.now()
            };
            
            if (!messages[currentChat.id]) {
                messages[currentChat.id] = [];
            }
            
            messages[currentChat.id].push(testMessage);
            loadMessages(currentChat.id);
            
            showNotification('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ±ÿ≥ÿßŸÑÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ©! ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸäŸáÿß ŸÑÿ™ÿ±Ÿâ ÿßŸÑÿ≥ÿ≠ÿ±! ‚ú®');
        }

        // ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ©
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const text = messageInput.value.trim();
            
            if (!text || !currentChat) {
                if (!currentChat) {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ£ŸàŸÑÿßŸã!', 'error');
                }
                return;
            }
            
            const newMessage = {
                id: Date.now(),
                text: text,
                sent: true,
                time: new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })
            };
            
            if (!messages[currentChat.id]) {
                messages[currentChat.id] = [];
            }
            
            messages[currentChat.id].push(newMessage);
            loadMessages(currentChat.id);
            
            messageInput.value = '';
            adjustTextareaHeight(messageInput);
            
            // ŸÖÿ≠ÿßŸÉÿßÿ© ÿ±ÿØ ÿ™ŸÑŸÇÿßÿ¶Ÿä
            setTimeout(() => {
                const autoReply = {
                    id: Date.now() + 1,
                    text: 'ÿ¥ŸÉÿ±ÿßŸã ŸÑŸÉ ÿπŸÑŸâ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©! üòä',
                    sent: false,
                    time: new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' })
                };
                messages[currentChat.id].push(autoReply);
                loadMessages(currentChat.id);
            }, 1000);
        }

        // ÿßŸÑÿ™ÿπÿßŸÖŸÑ ŸÖÿπ ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ Enter
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // ÿ™ÿπÿØŸäŸÑ ÿßÿ±ÿ™ŸÅÿßÿπ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÜÿµ
        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        // ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
        function switchTab(tabName) {
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÅÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿ∑ÿ© ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ŸàÿßŸÑŸÖÿ≠ÿ™ŸàŸâ
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿ∑ÿ© ŸÑŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿ≠ÿØÿØ
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.querySelector(`[data-content="${tabName}"]`).classList.add('active');
        }

        // ÿßŸÑÿ®ÿ≠ÿ´ ŸÅŸä ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ
        function searchContacts(query) {
            const contactItems = document.querySelectorAll('.contact-item');
            contactItems.forEach(item => {
                const name = item.querySelector('.font-semibold').textContent.toLowerCase();
                if (name.includes(query.toLowerCase())) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // ÿπÿ±ÿ∂ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 transform translate-x-full transition-transform duration-300 ${
                type === 'error' ? 'bg-red-500' : 'bg-green-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // === Ÿàÿ∏ÿßÿ¶ŸÅ ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÜÿ¨ŸàŸÖ ===
        
        // ÿπÿ±ÿ∂ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ŸÇŸäŸäŸÖ
        function showRatingPopup(starRatingElement, messageId) {
            // ÿ•ÿ≤ÿßŸÑÿ© ÿ£Ÿä ŸÜÿßŸÅÿ∞ÿ© ÿ™ŸÇŸäŸäŸÖ ŸÖŸàÿ¨ŸàÿØÿ©
            const existingPopup = document.querySelector('.rating-popup');
            if (existingPopup) {
                existingPopup.remove();
            }
            
            // ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ŸÇŸäŸäŸÖ
            const popup = document.createElement('div');
            popup.className = 'rating-popup';
            
            const stars = [];
            for (let i = 1; i <= 5; i++) {
                stars.push(`<span class="star empty" data-rating="${i}" onclick="rateMessage(${messageId}, ${i})">‚≠ê</span>`);
            }
            
            popup.innerHTML = stars.join('');
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ŸÑŸÑŸÜÿ¨ŸàŸÖ ŸÅŸä ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            popup.addEventListener('mouseover', function(e) {
                if (e.target.classList.contains('star')) {
                    const rating = parseInt(e.target.getAttribute('data-rating'));
                    const popupStars = popup.querySelectorAll('.star');
                    
                    popupStars.forEach((star, index) => {
                        if (index < rating) {
                            star.classList.remove('empty');
                            star.classList.add('filled');
                        } else {
                            star.classList.remove('filled');
                            star.classList.add('empty');
                        }
                    });
                }
            });
            
            popup.addEventListener('mouseleave', function() {
                const popupStars = popup.querySelectorAll('.star');
                popupStars.forEach(star => {
                    star.classList.remove('filled');
                    star.classList.add('empty');
                });
            });
            
            starRatingElement.appendChild(popup);
            
            // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            setTimeout(() => {
                popup.classList.add('show');
            }, 10);
            
            // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨Ÿáÿß
            setTimeout(() => {
                document.addEventListener('click', function hidePopup(e) {
                    if (!popup.contains(e.target) && !starRatingElement.contains(e.target)) {
                        popup.classList.remove('show');
                        setTimeout(() => {
                            if (popup.parentNode) {
                                popup.parentNode.removeChild(popup);
                            }
                        }, 300);
                        document.removeEventListener('click', hidePopup);
                    }
                });
            }, 100);
        }
        
        // ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
        function rateMessage(messageId, rating) {
            if (!currentChat) return;
            
            // ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© Ÿàÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ŸÇŸäŸäŸÖ
            const message = messages[currentChat.id].find(msg => msg.id === messageId);
            if (message) {
                const oldRating = message.rating || 0;
                message.rating = rating;
                message.ratingCount = (message.ratingCount || 0) + 1;
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ¨ŸàŸÖ
                updateStarDisplay(messageId, rating, message.ratingCount);
                
                // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ®ÿµÿ±Ÿäÿ©
                createStarBurstEffect(messageId, rating);
                
                // ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ©
                const ratingMessages = {
                    1: 'ÿ™ŸÇŸäŸäŸÖ ÿ∂ÿπŸäŸÅ! üòï ÿ±ÿ®ŸÖÿß ÿßŸÑŸÖÿ±ÿ© ÿßŸÑŸÇÿßÿØŸÖÿ© ÿ£ŸÅÿ∂ŸÑ',
                    2: 'ÿ™ŸÇŸäŸäŸÖ ŸÖŸÇÿ®ŸàŸÑ üòê ŸäŸÖŸÉŸÜ ÿ™ÿ≠ÿ≥ŸäŸÜŸá',
                    3: 'ÿ™ŸÇŸäŸäŸÖ ÿ¨ŸäÿØ! üòä ÿßÿ≥ÿ™ŸÖÿ± ŸáŸÉÿ∞ÿß',
                    4: 'ÿ™ŸÇŸäŸäŸÖ ŸÖŸÖÿ™ÿßÿ≤! üòç ÿ±ÿ≥ÿßŸÑÿ© ÿ±ÿßÿ¶ÿπÿ©',
                    5: 'ÿ™ŸÇŸäŸäŸÖ ŸÖÿ´ÿßŸÑŸä! ü§© ÿ±ÿ≥ÿßŸÑÿ© ÿ£ÿ≥ÿ∑Ÿàÿ±Ÿäÿ©!'
                };
                
                showNotification(ratingMessages[rating]);
                
                // ÿ•ÿÆŸÅÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ŸÇŸäŸäŸÖ
                const popup = document.querySelector('.rating-popup');
                if (popup) {
                    popup.classList.remove('show');
                    setTimeout(() => {
                        if (popup.parentNode) {
                            popup.parentNode.removeChild(popup);
                        }
                    }, 300);
                }
                
                // ÿßŸáÿ™ÿ≤ÿßÿ≤ ÿÆŸÅŸäŸÅ
                if (navigator.vibrate) {
                    navigator.vibrate([50, 50, 50]);
                }
            }
        }
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿ±ÿ∂ ÿßŸÑŸÜÿ¨ŸàŸÖ
        function updateStarDisplay(messageId, rating, ratingCount) {
            const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
            if (!messageElement) return;
            
            const starRating = messageElement.querySelector('.star-rating');
            if (!starRating) return;
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÜÿ¨ŸàŸÖ
            const stars = starRating.querySelectorAll('.star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('empty');
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                    star.classList.add('empty');
                }
            });
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿßÿØ ÿßŸÑÿ™ŸÇŸäŸäŸÖÿßÿ™
            let countElement = starRating.querySelector('.rating-count');
            if (ratingCount > 0) {
                if (!countElement) {
                    countElement = document.createElement('span');
                    countElement.className = 'rating-count';
                    starRating.insertBefore(countElement, starRating.firstChild);
                }
                countElement.textContent = ratingCount;
            }
            
            // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ
            starRating.classList.add('rating-celebration');
            setTimeout(() => {
                starRating.classList.remove('rating-celebration');
            }, 800);
        }
        
        // ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÜŸÅÿ¨ÿßÿ± ÿßŸÑŸÜÿ¨ŸàŸÖ
        function createStarBurstEffect(messageId, rating) {
            const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
            if (!messageElement) return;
            
            const starRating = messageElement.querySelector('.star-rating');
            if (!starRating) return;
            
            // ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿ¨ŸàŸÖ ŸÖÿ™ŸÅÿ¨ÿ±ÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑÿ™ŸÇŸäŸäŸÖ
            for (let i = 0; i < rating; i++) {
                setTimeout(() => {
                    const burstStar = document.createElement('div');
                    burstStar.className = 'star-burst';
                    burstStar.textContent = '‚≠ê';
                    
                    // ŸÖŸàÿ∂ÿπ ÿπÿ¥Ÿàÿßÿ¶Ÿä ÿ≠ŸàŸÑ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÜÿ¨ŸàŸÖ
                    const rect = starRating.getBoundingClientRect();
                    const randomX = Math.random() * 60 - 30;
                    const randomY = Math.random() * 60 - 30;
                    
                    burstStar.style.left = (rect.width / 2 + randomX) + 'px';
                    burstStar.style.top = (rect.height / 2 + randomY) + 'px';
                    
                    starRating.appendChild(burstStar);
                    
                    // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÜÿ¨ŸÖÿ© ÿ®ÿπÿØ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿ≠ÿ±ŸÉÿ©
                    setTimeout(() => {
                        if (burstStar.parentNode) {
                            burstStar.parentNode.removeChild(burstStar);
                        }
                    }, 1000);
                }, i * 100);
            }
        }
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ∂ÿßŸÅÿ© ÿ±ÿ≥ÿßŸÑÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÑÿ™ÿ¥ŸÖŸÑ ÿßŸÑŸÜÿ¨ŸàŸÖ ŸàÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿßŸÑÿ∑ÿßÿ¶ÿ±ÿ©
        function addInteractiveTestMessage() {
            if (!currentChat) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ£ŸàŸÑÿßŸã!', 'error');
                return;
            }
            
            const testMessages = [
                'ŸáŸáŸáŸáŸáŸáŸá Ÿáÿ∞ÿß ŸÖÿ∂ÿ≠ŸÉ ÿ¨ÿØÿßŸã! üòÇü§£',
                'ÿ£ÿ≠ÿ®ŸÉ ŸÉÿ´Ÿäÿ±ÿßŸã Ÿäÿß ÿ≠ÿ®Ÿäÿ®Ÿä ‚ù§Ô∏èüíï',
                'ŸàÿßŸà! Ÿáÿ∞ÿß ÿ±ÿßÿ¶ÿπ ŸàŸÖÿ∞ŸáŸÑ! ü§©‚ú®',
                'ŸÖÿ®ÿ±ŸàŸÉ ÿπŸÑŸâ ÿßŸÑŸÜÿ¨ÿßÿ≠! üéâüéä',
                'Ÿáÿ∞ÿß ÿ±ÿßÿ¶ÿπ ÿ¨ÿØÿßŸã! üî•üíØ',
                'ÿ£ŸÜÿ™ ÿßŸÑÿ£ŸÅÿ∂ŸÑ! ‚≠êüåü',
                'Ÿäÿß ŸáŸÑÿß Ÿàÿ∫ŸÑÿß! ü•≥üéâ',
                'ÿ£ÿ≠ÿ®ŸÉ ŸÖŸÜ ŸÉŸÑ ŸÇŸÑÿ®Ÿä! üòç‚ù§Ô∏èüíñ'
            ];
            
            const randomMessage = testMessages[Math.floor(Math.random() * testMessages.length)];
            
            const testMessage = {
                id: Date.now(),
                text: randomMessage,
                sent: true,
                time: new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),
                timestamp: Date.now(),
                rating: 0,
                ratingCount: 0
            };
            
            if (!messages[currentChat.id]) {
                messages[currentChat.id] = [];
            }
            
            messages[currentChat.id].push(testMessage);
            loadMessages(currentChat.id);
            
            // ÿ•ÿ∑ŸÑÿßŸÇ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿßŸÑÿ∑ÿßÿ¶ÿ±ÿ© ŸÖŸÜ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
            setTimeout(() => {
                const messageElement = document.querySelector(`[data-message-id="${testMessage.id}"]`);
                if (messageElement) {
                    detectAndLaunchEmojis(randomMessage, messageElement);
                }
            }, 200);
            
            showNotification('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿ±ÿ≥ÿßŸÑÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ©! ÿ¥ÿßŸáÿØ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿ™ÿ∑Ÿäÿ±! üöÄ‚≠ê');
        }

        // === Ÿàÿ∏ÿßÿ¶ŸÅ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿßŸÑÿ∑ÿßÿ¶ÿ±ÿ© ===
        
        // ŸÇÿßŸÖŸàÿ≥ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿßŸÑÿ∑ÿßÿ¶ÿ±ÿ© Ÿàÿ≠ÿ±ŸÉÿßÿ™Ÿáÿß
        const flyingEmojis = {
            'üòÇ': { type: 'laugh', animations: ['fly-bounce', 'fly-zigzag'], trail: true },
            'ü§£': { type: 'laugh', animations: ['fly-bounce', 'fly-spiral'], trail: true },
            'üòÜ': { type: 'laugh', animations: ['fly-straight', 'fly-bounce'], trail: false },
            '‚ù§Ô∏è': { type: 'heart', animations: ['fly-float', 'fly-spiral'], trail: false },
            'üíï': { type: 'heart', animations: ['fly-float', 'fly-bounce'], trail: false },
            'üíñ': { type: 'heart', animations: ['fly-spiral', 'fly-float'], trail: false },
            'üíó': { type: 'heart', animations: ['fly-bounce', 'fly-float'], trail: false },
            'üî•': { type: 'fire', animations: ['fly-straight', 'fly-zigzag'], trail: true },
            '‚≠ê': { type: 'star', animations: ['fly-spiral', 'fly-float'], trail: false },
            'üåü': { type: 'star', animations: ['fly-bounce', 'fly-spiral'], trail: false },
            '‚ú®': { type: 'star', animations: ['fly-float', 'fly-straight'], trail: false },
            'üéâ': { type: 'party', animations: ['fly-bounce', 'fly-zigzag'], trail: true },
            'üéä': { type: 'party', animations: ['fly-spiral', 'fly-bounce'], trail: true },
            'ü•≥': { type: 'party', animations: ['fly-zigzag', 'fly-spiral'], trail: false },
            'üòç': { type: 'heart', animations: ['fly-float', 'fly-spiral'], trail: false },
            'ü§©': { type: 'star', animations: ['fly-bounce', 'fly-float'], trail: false },
            'üíØ': { type: 'fire', animations: ['fly-straight', 'fly-bounce'], trail: true }
        };
        
        // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ŸÅŸä ÿßŸÑŸÜÿµ Ÿàÿ•ÿ∑ŸÑÿßŸÇŸáÿß
        function detectAndLaunchEmojis(text, sourceElement) {
            // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ŸÅŸä ÿßŸÑŸÜÿµ
            const emojiRegex = /(üòÇ|ü§£|üòÜ|‚ù§Ô∏è|üíï|üíñ|üíó|üî•|‚≠ê|üåü|‚ú®|üéâ|üéä|ü•≥|üòç|ü§©|üíØ)/g;
            const foundEmojis = text.match(emojiRegex);
            
            if (foundEmojis && foundEmojis.length > 0) {
                // ÿ•ÿ∑ŸÑÿßŸÇ ŸÉŸÑ ÿ•ŸäŸÖŸàÿ¨Ÿä ÿ®ÿ™ÿ£ÿÆŸäÿ± ŸÖÿÆÿ™ŸÑŸÅ
                foundEmojis.forEach((emoji, index) => {
                    setTimeout(() => {
                        launchFlyingEmoji(emoji, sourceElement);
                    }, index * 300); // ÿ™ÿ£ÿÆŸäÿ± 300ms ÿ®ŸäŸÜ ŸÉŸÑ ÿ•ŸäŸÖŸàÿ¨Ÿä
                });
                
                // ÿ•ÿ¥ÿπÿßÿ± ÿ™ŸÅÿßÿπŸÑŸä
                if (foundEmojis.length > 1) {
                    showNotification(`üöÄ ŸàÿßŸà! ${foundEmojis.length} ÿ•ŸäŸÖŸàÿ¨Ÿä ÿ™ÿ∑Ÿäÿ± ŸÅŸä ÿßŸÑÿ¥ÿßÿ¥ÿ©!`);
                } else {
                    showNotification(`‚ú® ÿ•ŸäŸÖŸàÿ¨Ÿä ${foundEmojis[0]} ÿ™ÿ∑Ÿäÿ± ŸÅŸä ÿßŸÑÿ¥ÿßÿ¥ÿ©!`);
                }
            }
        }
        
        // ÿ•ÿ∑ŸÑÿßŸÇ ÿ•ŸäŸÖŸàÿ¨Ÿä ÿ∑ÿßÿ¶ÿ±ÿ©
        function launchFlyingEmoji(emoji, sourceElement) {
            const emojiConfig = flyingEmojis[emoji];
            if (!emojiConfig) return;
            
            // ÿ•ŸÜÿ¥ÿßÿ° ÿπŸÜÿµÿ± ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿßŸÑÿ∑ÿßÿ¶ÿ±ÿ©
            const flyingEmoji = document.createElement('div');
            flyingEmoji.className = `flying-emoji emoji-${emojiConfig.type}`;
            flyingEmoji.textContent = emoji;
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ∞ŸäŸÑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ∑ŸÑŸàÿ®ÿßŸã
            if (emojiConfig.trail) {
                flyingEmoji.classList.add('emoji-trail');
                flyingEmoji.setAttribute('data-emoji', emoji);
            }
            
            // ÿ™ÿ≠ÿØŸäÿØ ŸÖŸàÿ∂ÿπ ÿßŸÑÿ®ÿØÿßŸäÿ© (ŸÖŸÜ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©)
            const rect = sourceElement.getBoundingClientRect();
            flyingEmoji.style.left = (rect.left + rect.width / 2) + 'px';
            flyingEmoji.style.top = (rect.top + rect.height / 2) + 'px';
            
            // ÿßÿÆÿ™Ÿäÿßÿ± ÿ≠ÿ±ŸÉÿ© ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ©
            const randomAnimation = emojiConfig.animations[Math.floor(Math.random() * emojiConfig.animations.length)];
            flyingEmoji.classList.add(randomAnimation);
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ŸÑŸÑÿµŸÅÿ≠ÿ©
            document.body.appendChild(flyingEmoji);
            
            // ÿ•ŸÜÿ¥ÿßÿ° ÿ•ŸäŸÖŸàÿ¨Ÿä ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÖÿ∂ÿßÿπŸÅ
            if (Math.random() > 0.7) { // 30% ÿßÿ≠ÿ™ŸÖÿßŸÑ
                setTimeout(() => {
                    createEmojiClone(emoji, sourceElement, emojiConfig);
                }, 500);
            }
            
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿ®ÿπÿØ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿ≠ÿ±ŸÉÿ©
            const animationDuration = getAnimationDuration(randomAnimation);
            setTimeout(() => {
                if (flyingEmoji.parentNode) {
                    flyingEmoji.parentNode.removeChild(flyingEmoji);
                }
            }, animationDuration);
        }
        
        // ÿ•ŸÜÿ¥ÿßÿ° ŸÜÿ≥ÿÆÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÖŸÜ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä
        function createEmojiClone(emoji, sourceElement, emojiConfig) {
            const clone = document.createElement('div');
            clone.className = `flying-emoji emoji-${emojiConfig.type}`;
            clone.textContent = emoji;
            clone.style.fontSize = '30px'; // ÿ£ÿµÿ∫ÿ± ŸÇŸÑŸäŸÑÿßŸã
            clone.style.opacity = '0.8';
            
            const rect = sourceElement.getBoundingClientRect();
            clone.style.left = (rect.left + rect.width / 2 + Math.random() * 100 - 50) + 'px';
            clone.style.top = (rect.top + rect.height / 2 + Math.random() * 50 - 25) + 'px';
            
            // ÿ≠ÿ±ŸÉÿ© ŸÖÿÆÿ™ŸÑŸÅÿ© ŸÑŸÑŸÜÿ≥ÿÆÿ©
            const animations = emojiConfig.animations.filter(anim => !clone.classList.contains(anim));
            const randomAnimation = animations[Math.floor(Math.random() * animations.length)] || 'fly-float';
            clone.classList.add(randomAnimation);
            
            document.body.appendChild(clone);
            
            const animationDuration = getAnimationDuration(randomAnimation);
            setTimeout(() => {
                if (clone.parentNode) {
                    clone.parentNode.removeChild(clone);
                }
            }, animationDuration);
        }
        
        // ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖÿØÿ© ÿßŸÑÿ≠ÿ±ŸÉÿ©
        function getAnimationDuration(animationType) {
            const durations = {
                'fly-straight': 4000,
                'fly-bounce': 5000,
                'fly-spiral': 6000,
                'fly-zigzag': 5000,
                'fly-float': 7000
            };
            return durations[animationType] || 5000;
        }
        
        // ÿ•ÿ∑ŸÑÿßŸÇ ÿ•ŸäŸÖŸàÿ¨Ÿä ÿπÿ¥Ÿàÿßÿ¶Ÿäÿ© (ŸÑŸÑÿßÿÆÿ™ÿ®ÿßÿ±)
        function launchRandomEmoji() {
            const emojis = Object.keys(flyingEmojis);
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            // ÿ•ŸÜÿ¥ÿßÿ° ÿπŸÜÿµÿ± ŸàŸáŸÖŸä ŸÉŸÖÿµÿØÿ±
            const dummySource = document.createElement('div');
            dummySource.style.position = 'fixed';
            dummySource.style.left = '50%';
            dummySource.style.top = '50%';
            dummySource.style.width = '1px';
            dummySource.style.height = '1px';
            document.body.appendChild(dummySource);
            
            launchFlyingEmoji(randomEmoji, dummySource);
            
            setTimeout(() => {
                if (dummySource.parentNode) {
                    dummySource.parentNode.removeChild(dummySource);
                }
            }, 100);
        }
        
        // ÿ•ÿ∑ŸÑÿßŸÇ ÿπÿßÿµŸÅÿ© ŸÖŸÜ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä
        function launchEmojiStorm(emoji, count = 5) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    launchRandomEmoji();
                }, i * 200);
            }
            showNotification(`üå™Ô∏è ÿπÿßÿµŸÅÿ© ŸÖŸÜ ${emoji}! ÿßÿ≥ÿ™ŸÖÿ™ÿπ ÿ®ÿßŸÑÿπÿ±ÿ∂!`);
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ŸÑÿ™ÿ¥ŸÖŸÑ ÿßŸÑŸÜÿ¨ŸàŸÖ ŸàÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿßŸÑÿ∑ÿßÿ¶ÿ±ÿ©
        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const text = messageInput.value.trim();
            
            if (!text || !currentChat) {
                if (!currentChat) {
                    showNotification('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ£ŸàŸÑÿßŸã!', 'error');
                }
                return;
            }
            
            const newMessage = {
                id: Date.now(),
                text: text,
                sent: true,
                time: new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),
                rating: 0,
                ratingCount: 0
            };
            
            if (!messages[currentChat.id]) {
                messages[currentChat.id] = [];
            }
            
            messages[currentChat.id].push(newMessage);
            loadMessages(currentChat.id);
            
            // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä Ÿàÿ•ÿ∑ŸÑÿßŸÇŸáÿß
            setTimeout(() => {
                const messageElement = document.querySelector(`[data-message-id="${newMessage.id}"]`);
                if (messageElement) {
                    detectAndLaunchEmojis(text, messageElement);
                }
            }, 100);
            
            messageInput.value = '';
            adjustTextareaHeight(messageInput);
            
            // ŸÖÿ≠ÿßŸÉÿßÿ© ÿ±ÿØ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÖÿπ ÿ™ŸÇŸäŸäŸÖ ÿπÿ¥Ÿàÿßÿ¶Ÿä
            setTimeout(() => {
                const autoReplies = [
                    'ÿ¥ŸÉÿ±ÿßŸã ŸÑŸÉ ÿπŸÑŸâ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©! üòä',
                    'ÿ±ÿßÿ¶ÿπ! üî•',
                    'ŸáŸáŸáŸáŸá üòÇ',
                    'ÿ£ÿ≠ÿ®ŸÉ ÿ£Ÿäÿ∂ÿßŸã! ‚ù§Ô∏è',
                    'ŸàÿßŸà ŸÖÿ∞ŸáŸÑ! ü§©',
                    'Ÿäÿß ŸáŸÑÿß! üéâ'
                ];
                
                const randomReply = autoReplies[Math.floor(Math.random() * autoReplies.length)];
                
                const autoReply = {
                    id: Date.now() + 1,
                    text: randomReply,
                    sent: false,
                    time: new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),
                    rating: Math.floor(Math.random() * 3) + 3,
                    ratingCount: Math.floor(Math.random() * 5) + 1
                };
                messages[currentChat.id].push(autoReply);
                loadMessages(currentChat.id);
                
                // ÿ•ÿ∑ŸÑÿßŸÇ ÿ•ŸäŸÖŸàÿ¨Ÿä ŸÖŸÜ ÿßŸÑÿ±ÿØ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä ÿ£Ÿäÿ∂ÿßŸã
                setTimeout(() => {
                    const replyElement = document.querySelector(`[data-message-id="${autoReply.id}"]`);
                    if (replyElement) {
                        detectAndLaunchEmojis(randomReply, replyElement);
                    }
                }, 100);
            }, 1500);
        }

        // === Ÿàÿ∏ÿßÿ¶ŸÅ ŸÜÿ∏ÿßŸÖ ÿßŸÑŸáÿØÿßŸäÿß ===
        
        // ÿπÿ±ÿ∂ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸáÿØÿßŸäÿß
        function showGiftMenu() {
            if (!currentChat) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ£ŸàŸÑÿßŸã!', 'error');
                return;
            }
            
            const giftMenu = document.getElementById('giftMenu');
            giftMenu.classList.add('show');
            
            // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨Ÿáÿß
            setTimeout(() => {
                document.addEventListener('click', function hideGiftMenu(e) {
                    if (!giftMenu.contains(e.target) && !e.target.closest('[onclick="showGiftMenu()"]')) {
                        giftMenu.classList.remove('show');
                        document.removeEventListener('click', hideGiftMenu);
                    }
                });
            }, 100);
        }
        
        // ÿ•ÿ±ÿ≥ÿßŸÑ ŸáÿØŸäÿ©
        function sendGift(emoji, name, type) {
            if (!currentChat) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ£ŸàŸÑÿßŸã!', 'error');
                return;
            }
            
            // ÿ•ÿÆŸÅÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸáÿØÿßŸäÿß
            document.getElementById('giftMenu').classList.remove('show');
            
            // ÿ•ŸÜÿ¥ÿßÿ° ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑŸáÿØŸäÿ©
            const giftMessage = {
                id: Date.now(),
                text: `üéÅ ŸáÿØŸäÿ©: ${name} ${emoji}`,
                sent: true,
                time: new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),
                isGift: true,
                giftEmoji: emoji,
                giftName: name,
                giftType: type,
                rating: 0,
                ratingCount: 0
            };
            
            if (!messages[currentChat.id]) {
                messages[currentChat.id] = [];
            }
            
            messages[currentChat.id].push(giftMessage);
            loadMessages(currentChat.id);
            
            // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸáÿØŸäÿ©
            createGiftSendEffect(emoji);
            showNotification(`ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ${name} ${emoji} ÿ®ŸÜÿ¨ÿßÿ≠!`);
            
            // ŸÖÿ≠ÿßŸÉÿßÿ© ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿßŸÑŸáÿØŸäÿ© ŸÖŸÜ ÿßŸÑÿ∑ÿ±ŸÅ ÿßŸÑÿ¢ÿÆÿ±
            setTimeout(() => {
                receiveGift(emoji, name, type);
            }, 2000);
        }
        
        // ÿßÿ≥ÿ™ŸÑÿßŸÖ ŸáÿØŸäÿ©
        function receiveGift(emoji, name, type) {
            if (!currentChat) return;
            
            // ÿ•ŸÜÿ¥ÿßÿ° ÿ±ÿ≥ÿßŸÑÿ© ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿßŸÑŸáÿØŸäÿ©
            const receivedGift = {
                id: Date.now(),
                text: `ÿ¥ŸÉÿ±ÿßŸã ŸÑŸÉ ÿπŸÑŸâ ${name} ÿßŸÑÿ¨ŸÖŸäŸÑÿ©! ${emoji}`,
                sent: false,
                time: new Date().toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' }),
                isReceivedGift: true,
                giftEmoji: emoji,
                giftName: name,
                giftType: type,
                rating: 5,
                ratingCount: 1
            };
            
            messages[currentChat.id].push(receivedGift);
            loadMessages(currentChat.id);
            
            // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿßŸÑŸáÿØŸäÿ©
            setTimeout(() => {
                const messageElement = document.querySelector(`[data-message-id="${receivedGift.id}"]`);
                if (messageElement) {
                    createGiftOpeningEffect(messageElement, emoji, name, type);
                }
            }, 100);
            
            // ÿ•ÿ¥ÿπÿßÿ± ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿßŸÑŸáÿØŸäÿ©
            showGiftNotification(emoji, name, currentChat.name);
        }
        
        // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸáÿØŸäÿ©
        function createGiftSendEffect(emoji) {
            // ÿ•ŸÜÿ¥ÿßÿ° ÿ¨ÿ≤Ÿäÿ¶ÿßÿ™ ÿßŸÑŸáÿØŸäÿ©
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'gift-particle';
                    particle.textContent = emoji;
                    
                    // ŸÖŸàÿ∂ÿπ ÿπÿ¥Ÿàÿßÿ¶Ÿä ÿ≠ŸàŸÑ Ÿàÿ≥ÿ∑ ÿßŸÑÿ¥ÿßÿ¥ÿ©
                    particle.style.left = (window.innerWidth / 2 + Math.random() * 200 - 100) + 'px';
                    particle.style.top = (window.innerHeight / 2 + Math.random() * 200 - 100) + 'px';
                    
                    document.body.appendChild(particle);
                    
                    // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ¨ÿ≤Ÿäÿ¶ÿ© ÿ®ÿπÿØ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿ≠ÿ±ŸÉÿ©
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 3000);
                }, i * 100);
            }
            
            // ÿßŸáÿ™ÿ≤ÿßÿ≤ ÿÆŸÅŸäŸÅ
            if (navigator.vibrate) {
                navigator.vibrate([100, 50, 100, 50, 200]);
            }
        }
        
        // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ŸÅÿ™ÿ≠ ÿßŸÑŸáÿØŸäÿ©
        function createGiftOpeningEffect(messageElement, emoji, name, type) {
            // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÅÿ™ÿ≠
            messageElement.classList.add('gift-opening');
            
            // ÿ•ŸÜÿ¥ÿßÿ° ÿ¨ÿ≤Ÿäÿ¶ÿßÿ™ ÿ≠ŸàŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
            const rect = messageElement.getBoundingClientRect();
            const particles = ['‚ú®', 'üéä', 'üéâ', 'üí´', '‚≠ê'];
            
            for (let i = 0; i < 12; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'gift-particle';
                    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                    
                    // ŸÖŸàÿ∂ÿπ ÿπÿ¥Ÿàÿßÿ¶Ÿä ÿ≠ŸàŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
                    particle.style.left = (rect.left + Math.random() * rect.width) + 'px';
                    particle.style.top = (rect.top + Math.random() * rect.height) + 'px';
                    
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 3000);
                }, i * 150);
            }
            
            // ÿ•ÿ≤ÿßŸÑÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÅÿ™ÿ≠
            setTimeout(() => {
                messageElement.classList.remove('gift-opening');
            }, 2000);
        }
        
        // ÿ•ÿ¥ÿπÿßÿ± ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿßŸÑŸáÿØŸäÿ©
        function showGiftNotification(emoji, name, senderName) {
            const notification = document.createElement('div');
            notification.className = 'gift-notification';
            
            notification.innerHTML = `
                <div class="gift-emoji-huge">${emoji}</div>
                <h2>üéÅ ŸáÿØŸäÿ© ÿ¨ÿØŸäÿØÿ©!</h2>
                <p>ŸÑŸÇÿØ ÿßÿ≥ÿ™ŸÑŸÖÿ™ <strong>${name}</strong> ŸÖŸÜ <strong>${senderName}</strong></p>
                <button onclick="closeGiftNotification(this)">ÿ±ÿßÿ¶ÿπ! üòç</button>
            `;
            
            document.body.appendChild(notification);
            
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ®ÿπÿØ 5 ÿ´ŸàÿßŸÜ
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
            
            // ÿßŸáÿ™ÿ≤ÿßÿ≤ ŸÇŸàŸä
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 300]);
            }
        }
        
        // ÿ•ÿ∫ŸÑÿßŸÇ ÿ•ÿ¥ÿπÿßÿ± ÿßŸÑŸáÿØŸäÿ©
        function closeGiftNotification(button) {
            const notification = button.closest('.gift-notification');
            if (notification) {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
        }
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ŸÑÿØÿπŸÖ ÿßŸÑŸáÿØÿßŸäÿß
        function loadMessages(contactId) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.innerHTML = '';
            
            if (!messages[contactId]) {
                messages[contactId] = [
                    { id: 1, text: 'ŸÖÿ±ÿ≠ÿ®ÿßŸã! ŸÉŸäŸÅ ÿ≠ÿßŸÑŸÉÿü', sent: false, time: '10:30', rating: 0, ratingCount: 0 },
                    { id: 2, text: 'ÿ£ŸáŸÑÿßŸã Ÿàÿ≥ŸáŸÑÿßŸã! ÿ®ÿÆŸäÿ± ŸàÿßŸÑÿ≠ŸÖÿØ ŸÑŸÑŸá ŸáŸáŸáŸáŸá üòÇ', sent: true, time: '10:32', rating: 4, ratingCount: 3 },
                    { id: 3, text: 'ŸÖÿß ÿ£ÿÆÿ®ÿßÿ±ŸÉÿü ÿ£ÿ≠ÿ®ŸÉ ŸÉÿ´Ÿäÿ±ÿßŸã ‚ù§Ô∏è', sent: false, time: '10:33', rating: 5, ratingCount: 2 },
                    { id: 4, text: 'ŸàÿßŸà! Ÿáÿ∞ÿß ÿ±ÿßÿ¶ÿπ ÿ¨ÿØÿßŸã ü§©', sent: true, time: '10:34', rating: 3, ratingCount: 1 },
                    { id: 5, text: 'ÿ£ŸÜÿß ÿ¨ÿßÿ¶ÿπ ÿ¨ÿØÿßŸã üçï', sent: false, time: '10:35', rating: 2, ratingCount: 1 }
                ];
            }
            
            messages[contactId].forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = `message ${message.sent ? 'sent' : 'received'}`;
                messageElement.setAttribute('data-message-id', message.id);
                
                if (message.isGift || message.isReceivedGift) {
                    // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸáÿØÿßŸäÿß
                    const giftClass = message.giftType ? `gift-${message.giftType}` : '';
                    messageElement.innerHTML = `
                        <div class="message-bubble gift-message ${giftClass}" style="max-width: 90%;">
                            <div class="gift-content">
                                <span class="gift-emoji-large">${message.giftEmoji}</span>
                                <div class="gift-text">${message.isGift ? 'ÿ£ÿ±ÿ≥ŸÑÿ™' : 'ÿßÿ≥ÿ™ŸÑŸÖÿ™'} ${message.giftName}</div>
                                <div class="gift-sender">${message.isGift ? 'ÿ•ŸÑŸäŸÉ' : `ŸÖŸÜ ${currentChat.name}`}</div>
                            </div>
                            <div class="text-xs opacity-70 mt-2">${message.time}</div>
                            ${message.isReceivedGift ? createStarRating(message.rating || 0, message.ratingCount || 0, message.id) : ''}
                        </div>
                    `;
                } else {
                    // ÿπÿ±ÿ∂ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿπÿßÿØŸäÿ© ŸÖÿπ ÿßŸÑÿ™ŸÅÿßÿπŸÑ ŸàÿßŸÑŸÜÿ¨ŸàŸÖ
                    const processedText = makeTextInteractive(message.text);
                    const starRating = createStarRating(message.rating || 0, message.ratingCount || 0, message.id);
                    
                    messageElement.innerHTML = `
                        <div class="message-bubble interactive-message" onclick="handleMessageClick(this, '${message.text.replace(/'/g, "\\'")}')">
                            ${processedText}
                            <div class="text-xs opacity-70 mt-1">${message.time}</div>
                            ${starRating}
                        </div>
                    `;
                }
                
                messageContainer.appendChild(messageElement);
            });
            
            messageContainer.scrollTop = messageContainer.scrollHeight;
        }

        // === Ÿàÿ∏ÿßÿ¶ŸÅ ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ© ===
        
        // ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™
        let dailyMemories = JSON.parse(localStorage.getItem('dailyMemories') || '[]');
        let selectedMood = null;
        let selectedMoodEmoji = null;
        let selectedMoodLabel = null;
        
        // ÿπÿ±ÿ∂ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ©
        function showDailyMemoryPrompt() {
            const popup = document.getElementById('memoryPopup');
            const dateElement = document.getElementById('memoryDate');
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ
            const today = new Date();
            const arabicDate = today.toLocaleDateString('ar-SA', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            dateElement.textContent = arabicDate;
            
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿ∞ŸÉÿ±Ÿâ ŸÑŸÑŸäŸàŸÖ
            const todayKey = today.toDateString();
            const existingMemory = dailyMemories.find(memory => memory.date === todayKey);
            
            if (existingMemory) {
                // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸáŸÜÿßŸÉ ÿ∞ŸÉÿ±Ÿâ ŸÑŸÑŸäŸàŸÖÿå ÿßÿπÿ±ÿ∂Ÿáÿß ŸÑŸÑÿ™ÿπÿØŸäŸÑ
                document.getElementById('memoryText').value = existingMemory.text;
                selectMoodByEmoji(existingMemory.mood);
                document.querySelector('.memory-question').textContent = 'ÿ™ÿπÿØŸäŸÑ ÿ∞ŸÉÿ±Ÿâ ÿßŸÑŸäŸàŸÖ üìù';
            } else {
                // ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸáŸÜÿßŸÉ ÿ∞ŸÉÿ±Ÿâÿå ÿßÿ®ÿØÿ£ ÿ¨ÿØŸäÿØÿ©
                document.getElementById('memoryText').value = '';
                clearMoodSelection();
                document.querySelector('.memory-question').textContent = 'ŸÉŸäŸÅ ŸÉÿßŸÜ ŸäŸàŸÖŸÉ ÿßŸÑŸäŸàŸÖÿü üòä';
            }
            
            popup.classList.add('show');
            
            // ÿ™ÿ±ŸÉŸäÿ≤ ÿπŸÑŸâ ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑŸÜÿµ
            setTimeout(() => {
                document.getElementById('memoryText').focus();
            }, 500);
        }
        
        // ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ≤ÿßÿ¨
        function selectMood(element, emoji, label) {
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ™ÿ≠ÿØŸäÿØ ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™
            document.querySelectorAll('.mood-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑÿÆŸäÿßÿ± ÿßŸÑŸÖÿÆÿ™ÿßÿ±
            element.classList.add('selected');
            selectedMood = element;
            selectedMoodEmoji = emoji;
            selectedMoodLabel = label;
            
            // ÿ™ÿ£ÿ´Ÿäÿ± ÿ®ÿµÿ±Ÿä
            createMemoryParticles(element, [emoji, '‚ú®', 'üí´']);
            
            // ÿßŸáÿ™ÿ≤ÿßÿ≤ ÿÆŸÅŸäŸÅ
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }
        
        // ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖÿ≤ÿßÿ¨ ÿ®ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä (ŸÑŸÑÿ™ÿπÿØŸäŸÑ)
        function selectMoodByEmoji(emoji) {
            const moodOptions = document.querySelectorAll('.mood-option');
            moodOptions.forEach(option => {
                const moodEmoji = option.querySelector('.mood-emoji').textContent;
                if (moodEmoji === emoji) {
                    const label = option.querySelector('.mood-label').textContent;
                    selectMood(option, emoji, label);
                }
            });
        }
        
        // ŸÖÿ≥ÿ≠ ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÖÿ≤ÿßÿ¨
        function clearMoodSelection() {
            document.querySelectorAll('.mood-option').forEach(option => {
                option.classList.remove('selected');
            });
            selectedMood = null;
            selectedMoodEmoji = null;
            selectedMoodLabel = null;
        }
        
        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ∞ŸÉÿ±Ÿâ
        function saveMemory() {
            const memoryText = document.getElementById('memoryText').value.trim();
            
            if (!memoryText) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ÿ¥Ÿäÿ° ÿπŸÜ ŸäŸàŸÖŸÉ! üìù', 'error');
                return;
            }
            
            if (!selectedMoodEmoji) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ≤ÿßÿ¨ŸÉ ÿßŸÑŸäŸàŸÖ! üòä', 'error');
                return;
            }
            
            const today = new Date();
            const todayKey = today.toDateString();
            
            // ÿ•ŸÜÿ¥ÿßÿ° ÿ£Ÿà ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ∞ŸÉÿ±Ÿâ
            const memory = {
                id: Date.now(),
                date: todayKey,
                dateFormatted: today.toLocaleDateString('ar-SA', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                }),
                mood: selectedMoodEmoji,
                moodLabel: selectedMoodLabel,
                text: memoryText,
                timestamp: today.getTime(),
                wordCount: memoryText.split(' ').length
            };
            
            // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ∞ŸÉÿ±Ÿâ ŸÖŸàÿ¨ŸàÿØÿ© ŸÑŸÑŸäŸàŸÖ
            const existingIndex = dailyMemories.findIndex(m => m.date === todayKey);
            
            if (existingIndex !== -1) {
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ∞ŸÉÿ±Ÿâ ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ©
                dailyMemories[existingIndex] = memory;
                showNotification('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿ∞ŸÉÿ±Ÿâ ÿßŸÑŸäŸàŸÖ! ‚ú®');
            } else {
                // ÿ•ÿ∂ÿßŸÅÿ© ÿ∞ŸÉÿ±Ÿâ ÿ¨ÿØŸäÿØÿ©
                dailyMemories.unshift(memory);
                showNotification('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ∞ŸÉÿ±Ÿâ ÿßŸÑŸäŸàŸÖ! üéâ');
            }
            
            // ÿ≠ŸÅÿ∏ ŸÅŸä ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≠ŸÑŸä
            localStorage.setItem('dailyMemories', JSON.stringify(dailyMemories));
            
            // ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ
            createMemoryCelebration();
            
            // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÜÿßŸÅÿ∞ÿ©
            setTimeout(() => {
                closeMemoryPopup();
            }, 1500);
        }
        
        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™
        function closeMemoryPopup() {
            const popup = document.getElementById('memoryPopup');
            popup.classList.remove('show');
            
            // ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
            setTimeout(() => {
                document.getElementById('memoryText').value = '';
                clearMoodSelection();
            }, 500);
        }
        
        // ÿπÿ±ÿ∂ ÿµŸÅÿ≠ÿ© ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™
        function showMemoriesPage() {
            const page = document.getElementById('memoriesPage');
            page.classList.add('show');
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
            updateMemoriesStats();
            
            // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™
            loadMemoriesGrid();
        }
        
        // ÿ•ÿ∫ŸÑÿßŸÇ ÿµŸÅÿ≠ÿ© ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™
        function closeMemoriesPage() {
            const page = document.getElementById('memoriesPage');
            page.classList.remove('show');
        }
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™
        function updateMemoriesStats() {
            const totalMemories = dailyMemories.length;
            const happyDays = dailyMemories.filter(memory => 
                ['üòä', 'üòç', 'ü•≥', 'üòÑ', 'ü§©'].includes(memory.mood)
            ).length;
            
            // ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑŸÖÿ™ÿ™ÿßŸÑŸäÿ©
            let currentStreak = 0;
            const today = new Date();
            let checkDate = new Date(today);
            
            for (let i = 0; i < 30; i++) { // ŸÅÿ≠ÿµ ÿ¢ÿÆÿ± 30 ŸäŸàŸÖ
                const dateKey = checkDate.toDateString();
                const hasMemory = dailyMemories.some(memory => memory.date === dateKey);
                
                if (hasMemory) {
                    currentStreak++;
                } else {
                    break;
                }
                
                checkDate.setDate(checkDate.getDate() - 1);
            }
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿ±ÿ∂
            document.getElementById('totalMemories').textContent = totalMemories;
            document.getElementById('happyDays').textContent = happyDays;
            document.getElementById('currentStreak').textContent = currentStreak;
        }
        
        // ÿ™ÿ≠ŸÖŸäŸÑ ÿ¥ÿ®ŸÉÿ© ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™
        function loadMemoriesGrid() {
            const grid = document.getElementById('memoriesGrid');
            grid.innerHTML = '';
            
            if (dailyMemories.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #666;">
                        <div style="font-size: 60px; margin-bottom: 20px;">üìñ</div>
                        <h3 style="margin: 0 0 10px 0; color: var(--primary-color);">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ∞ŸÉÿ±Ÿäÿßÿ™ ÿ®ÿπÿØ</h3>
                        <p style="margin: 0;">ÿßÿ®ÿØÿ£ ÿ®ŸÉÿ™ÿßÿ®ÿ© ÿ∞ŸÉÿ±Ÿâ ŸäŸàŸÖŸÉ ÿßŸÑÿ£ŸàŸÑŸâ!</p>
                        <button onclick="closeMemoriesPage(); showDailyMemoryPrompt();" 
                                style="margin-top: 20px; background: var(--primary-gradient); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer;">
                            ÿßŸÉÿ™ÿ® ÿ∞ŸÉÿ±Ÿâ ÿßŸÑŸäŸàŸÖ ‚ú®
                        </button>
                    </div>
                `;
                return;
            }
            
            dailyMemories.forEach(memory => {
                const memoryElement = document.createElement('div');
                memoryElement.className = 'memory-item';
                
                // ÿ™ÿ≠ÿØŸäÿØ ŸÑŸàŸÜ ÿßŸÑÿÆŸÑŸÅŸäÿ© ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ÿßŸÑŸÖÿ≤ÿßÿ¨
                const moodColors = {
                    'üòä': 'linear-gradient(135deg, #ffeaa7, #fdcb6e)',
                    'üò¢': 'linear-gradient(135deg, #a8e6cf, #74b9ff)',
                    'üò¥': 'linear-gradient(135deg, #ddd6fe, #c084fc)',
                    'üòç': 'linear-gradient(135deg, #ff7675, #fd79a8)',
                    'üò§': 'linear-gradient(135deg, #ff6b6b, #ee5a52)',
                    'ü§î': 'linear-gradient(135deg, #81ecec, #00cec9)'
                };
                
                const bgColor = moodColors[memory.mood] || 'linear-gradient(135deg, #f8f9fa, #e9ecef)';
                
                memoryElement.innerHTML = `
                    <div class="memory-item-header">
                        <div class="memory-item-date">${memory.dateFormatted}</div>
                        <div class="memory-item-mood">${memory.mood}</div>
                    </div>
                    <div class="memory-item-text">${memory.text}</div>
                    <div class="memory-item-footer">
                        <span>ÿßŸÑŸÖÿ≤ÿßÿ¨: ${memory.moodLabel}</span>
                        <span>${memory.wordCount} ŸÉŸÑŸÖÿ©</span>
                    </div>
                `;
                
                // ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸàŸÜ ÿßŸÑÿÆŸÑŸÅŸäÿ©
                memoryElement.style.background = bgColor;
                
                grid.appendChild(memoryElement);
            });
        }
        
        // ÿ•ŸÜÿ¥ÿßÿ° ÿ¨ÿ≤Ÿäÿ¶ÿßÿ™ ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™
        function createMemoryParticles(sourceElement, particles) {
            const rect = sourceElement.getBoundingClientRect();
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'memory-particle';
                    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                    
                    // ŸÖŸàÿ∂ÿπ ÿπÿ¥Ÿàÿßÿ¶Ÿä ÿ≠ŸàŸÑ ÿßŸÑÿπŸÜÿµÿ±
                    particle.style.left = (rect.left + rect.width / 2 + Math.random() * 60 - 30) + 'px';
                    particle.style.top = (rect.top + rect.height / 2 + Math.random() * 60 - 30) + 'px';
                    
                    document.body.appendChild(particle);
                    
                    // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ¨ÿ≤Ÿäÿ¶ÿ© ÿ®ÿπÿØ ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑÿ≠ÿ±ŸÉÿ©
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 3000);
                }, i * 100);
            }
        }
        
        // ÿ•ŸÜÿ¥ÿßÿ° ÿßÿ≠ÿ™ŸÅÿßŸÑ ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™
        function createMemoryCelebration() {
            const memoryCard = document.querySelector('.memory-card');
            memoryCard.classList.add('memory-celebration');
            
            // ÿ¨ÿ≤Ÿäÿ¶ÿßÿ™ ÿßÿ≠ÿ™ŸÅÿßŸÑŸäÿ©
            const celebrationParticles = ['üéâ', '‚ú®', 'üåü', 'üí´', 'üéä', 'ü•≥'];
            
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'memory-particle';
                    particle.textContent = celebrationParticles[Math.floor(Math.random() * celebrationParticles.length)];
                    
                    // ŸÖŸàÿ∂ÿπ ÿπÿ¥Ÿàÿßÿ¶Ÿä ÿ≠ŸàŸÑ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©
                    particle.style.left = (window.innerWidth / 2 + Math.random() * 400 - 200) + 'px';
                    particle.style.top = (window.innerHeight / 2 + Math.random() * 300 - 150) + 'px';
                    
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 3000);
                }, i * 100);
            }
            
            // ÿ•ÿ≤ÿßŸÑÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿßÿ≠ÿ™ŸÅÿßŸÑ
            setTimeout(() => {
                memoryCard.classList.remove('memory-celebration');
            }, 1000);
            
            // ÿßŸáÿ™ÿ≤ÿßÿ≤ ŸÇŸàŸä
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 300]);
            }
        }
        
        // ŸÅÿ≠ÿµ ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ© (Ÿäÿ™ŸÖ ÿßÿ≥ÿ™ÿØÿπÿßÿ§Ÿáÿß ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã)
        function checkDailyMemoryReminder() {
            const now = new Date();
            const hour = now.getHours();
            
            // ŸÅÿ≠ÿµ ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ° (ÿ®ŸäŸÜ 6 ŸÖÿ≥ÿßÿ°Ÿã Ÿà 11 ŸÖÿ≥ÿßÿ°Ÿã)
            if (hour >= 18 && hour <= 23) {
                const todayKey = now.toDateString();
                const hasMemoryToday = dailyMemories.some(memory => memory.date === todayKey);
                
                if (!hasMemoryToday) {
                    // ÿ•ÿ∏Ÿáÿßÿ± ÿ™ÿ∞ŸÉŸäÿ± ŸÑÿ∑ŸäŸÅ
                    setTimeout(() => {
                        showNotification('üåô ŸÉŸäŸÅ ŸÉÿßŸÜ ŸäŸàŸÖŸÉÿü ŸÑÿß ÿ™ŸÜÿ≥ ŸÉÿ™ÿßÿ®ÿ© ÿ∞ŸÉÿ±Ÿäÿßÿ™ŸÉ!');
                        
                        // ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑŸÜÿßŸÅÿ∞ÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ®ÿπÿØ 5 ÿ´ŸàÿßŸÜ
                        setTimeout(() => {
                            if (confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ŸÉÿ™ÿßÿ®ÿ© ÿ∞ŸÉÿ±Ÿâ ÿßŸÑŸäŸàŸÖ ÿßŸÑÿ¢ŸÜÿü üìù')) {
                                showDailyMemoryPrompt();
                            }
                        }, 5000);
                    }, 3000);
                }
            }
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿπŸÜÿØ ÿ®ÿØÿ° ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        document.addEventListener('DOMContentLoaded', function() {
            // ÿ™ÿ≠ŸÖŸäŸÑ Ÿàÿßÿ¨Ÿáÿ© ÿ¨Ÿáÿßÿ™ ÿßŸÑÿßÿ™ÿµÿßŸÑ
            loadContacts();
            
            // ÿ±ÿ≥ÿßŸÑÿ© ÿ™ÿ±ÿ≠Ÿäÿ®
            showNotification('ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿßŸÑŸÖÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÖÿ™ÿ∑Ÿàÿ±! üöÄ');
            showNotification('ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿ£Ÿä ÿµÿØŸäŸÇ ŸÑŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©! üëÜ');
            showNotification('ÿ¨ÿ±ÿ® ŸÜÿ∏ÿßŸÖ ÿßŸÑŸáÿØÿßŸäÿß ÿßŸÑÿ¨ÿØŸäÿØ! üéÅ‚ú®');
            showNotification('ŸÑÿß ÿ™ŸÜÿ≥ ŸÉÿ™ÿßÿ®ÿ© ÿ∞ŸÉÿ±Ÿäÿßÿ™ŸÉ ÿßŸÑŸäŸàŸÖŸäÿ©! üìñüí≠');
            
            // ŸÅÿ≠ÿµ ÿ™ÿ∞ŸÉŸäÿ± ÿßŸÑÿ∞ŸÉÿ±Ÿäÿßÿ™ ÿßŸÑŸäŸàŸÖŸäÿ©
            checkDailyMemoryReminder();
            
            // ŸÅÿ≠ÿµ ŸÉŸÑ ÿ≥ÿßÿπÿ©
            setInterval(checkDailyMemoryReminder, 3600000); // ŸÉŸÑ ÿ≥ÿßÿπÿ©
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'989ce14de4013415',t:'MTc1OTY2NjkwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
